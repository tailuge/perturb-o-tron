!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=e()}}((function(){return function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[s]={exports:{}};t[s][0].call(u.exports,(function(e){return o(t[s][1][e]||e)}),u,u.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){
/* @license
 * Copyright (c) 2016, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var n=function(e){var t="b",r="w",n=-1,o="p",i="n",s="b",a="r",c="q",l="k",u="pnbrqkPNBRQK",d="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",f=["1-0","0-1","1/2-1/2","*"],p={b:[16,32,17,15],w:[-16,-32,-17,-15]},h={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},v=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],g=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],m={p:0,n:1,b:2,r:3,q:4,k:5},b={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},w=7,P=6,k=1,E=0,_={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},C={w:[{square:_.a1,flag:y.QSIDE_CASTLE},{square:_.h1,flag:y.KSIDE_CASTLE}],b:[{square:_.a8,flag:y.QSIDE_CASTLE},{square:_.h8,flag:y.KSIDE_CASTLE}]},S=new Array(128),A={w:n,b:n},O=r,M={w:0,b:0},T=n,x=0,q=1,j=[],I={};function F(){S=new Array(128),A={w:n,b:n},O=r,M={w:0,b:0},T=n,x=0,q=1,j=[],I={},U(R())}function L(){N(d)}function N(e){var o=e.split(/\s+/),i=o[0],s=0;if(!D(e).valid)return!1;F();for(var a=0;a<i.length;a++){var c=i.charAt(a);if("/"===c)s+=8;else if(-1!=="0123456789".indexOf(c))s+=parseInt(c,10);else{var l=c<"a"?r:t;Q({type:c.toLowerCase(),color:l},se(s)),s++}}return O=o[1],o[2].indexOf("K")>-1&&(M.w|=y.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(M.w|=y.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(M.b|=y.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(M.b|=y.QSIDE_CASTLE),T="-"===o[3]?n:_[o[3]],x=parseInt(o[4],10),q=parseInt(o[5],10),U(R()),!0}function D(e){var t="No errors.",r="FEN string must contain six space-delimited fields.",n="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",s="3rd field (castling availability) is invalid.",a="2nd field (side to move) is invalid.",c="1st field (piece positions) does not contain 8 '/'-delimited rows.",l="1st field (piece positions) is invalid [consecutive numbers].",u="1st field (piece positions) is invalid [invalid piece].",d="1st field (piece positions) is invalid [row too large].",f="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:r};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:n};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:s};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:a};var h=p[0].split("/");if(8!==h.length)return{valid:!1,error_number:7,error:c};for(var v=0;v<h.length;v++){for(var g=0,m=!1,b=0;b<h[v].length;b++)if(isNaN(h[v][b])){if(!/^[prnbqkPRNBQK]$/.test(h[v][b]))return{valid:!1,error_number:9,error:u};g+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:l};g+=parseInt(h[v][b],10),m=!0}if(8!==g)return{valid:!1,error_number:10,error:d}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:f}:{valid:!0,error_number:0,error:t}}function R(){for(var e=0,o="",i=_.a8;i<=_.h1;i++){if(null==S[i])e++;else{e>0&&(o+=e,e=0);var s=S[i].color,a=S[i].type;o+=s===r?a.toUpperCase():a.toLowerCase()}i+1&136&&(e>0&&(o+=e),i!==_.h1&&(o+="/"),e=0,i+=8)}var c="";M[r]&y.KSIDE_CASTLE&&(c+="K"),M[r]&y.QSIDE_CASTLE&&(c+="Q"),M[t]&y.KSIDE_CASTLE&&(c+="k"),M[t]&y.QSIDE_CASTLE&&(c+="q"),c=c||"-";var l=T===n?"-":se(T);return[o,O,c,l,x,q].join(" ")}function K(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(I[e[t]]=e[t+1]);return I}function U(e){j.length>0||(e!==d?(I.SetUp="1",I.FEN=e):(delete I.SetUp,delete I.FEN))}function B(e){var t=S[_[e]];return t?{type:t.type,color:t.color}:null}function Q(e,t){if(!("type"in e&&"color"in e))return!1;if(-1===u.indexOf(e.type.toLowerCase()))return!1;if(!(t in _))return!1;var r=_[t];return(e.type!=l||A[e.color]==n||A[e.color]==r)&&(S[r]={type:e.type,color:e.color},e.type===l&&(A[e.color]=r),U(R()),!0)}function $(e,t,r,n,i){var s={color:O,from:t,to:r,flags:n,piece:e[t].type};return i&&(s.flags|=y.PROMOTION,s.promotion=i),e[r]?s.captured=e[r].type:n&y.EP_CAPTURE&&(s.captured=o),s}function W(e){function t(e,t,r,n,l){if(e[r].type!==o||oe(n)!==E&&oe(n)!==w)t.push($(e,r,n,l));else for(var u=[c,a,s,i],d=0,f=u.length;d<f;d++)t.push($(e,r,n,l,u[d]))}var r=[],n=O,l=ae(n),u={b:k,w:P},d=_.a8,f=_.h1,v=!1,g=!(void 0!==e&&"legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in _))return[];d=f=_[e.square],v=!0}for(var m=d;m<=f;m++)if(136&m)m+=7;else{var b=S[m];if(null!=b&&b.color===n)if(b.type===o){var C=m+p[n][0];if(null==S[C]){t(S,r,m,C,y.NORMAL);C=m+p[n][1];u[n]===oe(m)&&null==S[C]&&t(S,r,m,C,y.BIG_PAWN)}for(x=2;x<4;x++){136&(C=m+p[n][x])||(null!=S[C]&&S[C].color===l?t(S,r,m,C,y.CAPTURE):C===T&&t(S,r,m,T,y.EP_CAPTURE))}}else for(var x=0,q=h[b.type].length;x<q;x++){var j=h[b.type][x];for(C=m;!(136&(C+=j));){if(null!=S[C]){if(S[C].color===n)break;t(S,r,m,C,y.CAPTURE);break}if(t(S,r,m,C,y.NORMAL),"n"===b.type||"k"===b.type)break}}}if(!v||f===A[n]){if(M[n]&y.KSIDE_CASTLE){var I=(F=A[n])+2;null!=S[F+1]||null!=S[I]||V(l,A[n])||V(l,F+1)||V(l,I)||t(S,r,A[n],I,y.KSIDE_CASTLE)}if(M[n]&y.QSIDE_CASTLE){var F;I=(F=A[n])-2;null!=S[F-1]||null!=S[F-2]||null!=S[F-3]||V(l,A[n])||V(l,F-1)||V(l,I)||t(S,r,A[n],I,y.QSIDE_CASTLE)}}if(!g)return r;var L=[];for(m=0,q=r.length;m<q;m++)te(r[m]),X(n)||L.push(r[m]),re();return L}function G(e,t){var r="";if(e.flags&y.KSIDE_CASTLE)r="O-O";else if(e.flags&y.QSIDE_CASTLE)r="O-O-O";else{var n=function(e,t){for(var r=W({legal:!t}),n=e.from,o=e.to,i=e.piece,s=0,a=0,c=0,l=0,u=r.length;l<u;l++){var d=r[l].from,f=r[l].to,p=r[l].piece;i===p&&n!==d&&o===f&&(s++,oe(n)===oe(d)&&a++,ie(n)===ie(d)&&c++)}if(s>0)return a>0&&c>0?se(n):c>0?se(n).charAt(1):se(n).charAt(0);return""}(e,t);e.piece!==o&&(r+=e.piece.toUpperCase()+n),e.flags&(y.CAPTURE|y.EP_CAPTURE)&&(e.piece===o&&(r+=se(e.from)[0]),r+="x"),r+=se(e.to),e.flags&y.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return te(e),z()&&(Z()?r+="#":r+="+"),re(),r}function H(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function V(e,n){for(var i=_.a8;i<=_.h1;i++)if(136&i)i+=7;else if(null!=S[i]&&S[i].color===e){var s=S[i],a=i-n,c=a+119;if(v[c]&1<<m[s.type]){if(s.type===o){if(a>0){if(s.color===r)return!0}else if(s.color===t)return!0;continue}if("n"===s.type||"k"===s.type)return!0;for(var l=g[c],u=i+l,d=!1;u!==n;){if(null!=S[u]){d=!0;break}u+=l}if(!d)return!0}}return!1}function X(e){return V(ae(e),A[e])}function z(){return X(O)}function Z(){return z()&&0===W().length}function Y(){return!z()&&0===W().length}function J(){for(var e={},t=[],r=0,n=0,o=_.a8;o<=_.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var a=S[o];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===s&&t.push(n),r++)}if(2===r)return!0;if(3===r&&(1===e[s]||1===e[i]))return!0;if(r===e[s]+2){var c=0,l=t.length;for(o=0;o<l;o++)c+=t[o];if(0===c||c===l)return!0}return!1}function ee(){for(var e=[],t={},r=!1;;){var n=re();if(!n)break;e.push(n)}for(;;){var o=R().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(r=!0),!e.length)break;te(e.pop())}return r}function te(e){var r=O,i=ae(r);if(function(e){j.push({move:e,kings:{b:A.b,w:A.w},turn:O,castling:{b:M.b,w:M.w},ep_square:T,half_moves:x,move_number:q})}(e),S[e.to]=S[e.from],S[e.from]=null,e.flags&y.EP_CAPTURE&&(O===t?S[e.to-16]=null:S[e.to+16]=null),e.flags&y.PROMOTION&&(S[e.to]={type:e.promotion,color:r}),S[e.to].type===l){if(A[S[e.to].color]=e.to,e.flags&y.KSIDE_CASTLE){var s=e.to-1,a=e.to+1;S[s]=S[a],S[a]=null}else if(e.flags&y.QSIDE_CASTLE){s=e.to+1,a=e.to-2;S[s]=S[a],S[a]=null}M[r]=""}if(M[r])for(var c=0,u=C[r].length;c<u;c++)if(e.from===C[r][c].square&&M[r]&C[r][c].flag){M[r]^=C[r][c].flag;break}if(M[i])for(c=0,u=C[i].length;c<u;c++)if(e.to===C[i][c].square&&M[i]&C[i][c].flag){M[i]^=C[i][c].flag;break}T=e.flags&y.BIG_PAWN?"b"===O?e.to-16:e.to+16:n,e.piece===o?x=0:e.flags&(y.CAPTURE|y.EP_CAPTURE)?x=0:x++,O===t&&q++,O=ae(O)}function re(){var e=j.pop();if(null==e)return null;var r=e.move;A=e.kings,O=e.turn,M=e.castling,T=e.ep_square,x=e.half_moves,q=e.move_number;var n,i,s=O,a=ae(O);if(S[r.from]=S[r.to],S[r.from].type=r.piece,S[r.to]=null,r.flags&y.CAPTURE)S[r.to]={type:r.captured,color:a};else if(r.flags&y.EP_CAPTURE){var c;c=s===t?r.to-16:r.to+16,S[c]={type:o,color:a}}r.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)&&(r.flags&y.KSIDE_CASTLE?(n=r.to+1,i=r.to-1):r.flags&y.QSIDE_CASTLE&&(n=r.to-2,i=r.to+1),S[n]=S[i],S[i]=null);return r}function ne(e,t){var r=H(e);if(t){var n=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(n)var o=n[1],i=n[2],s=n[3],a=n[4]}for(var c=W(),l=0,u=c.length;l<u;l++){if(r===H(G(c[l]))||t&&r===H(G(c[l],!0)))return c[l];if(n&&(!o||o.toLowerCase()==c[l].piece)&&_[i]==c[l].from&&_[s]==c[l].to&&(!a||a.toLowerCase()==c[l].promotion))return c[l]}return null}function oe(e){return e>>4}function ie(e){return 15&e}function se(e){var t=ie(e),r=oe(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function ae(e){return e===r?t:r}function ce(e){var t=function e(t){var r=t instanceof Array?[]:{};for(var n in t)r[n]="object"==typeof n?e(t[n]):t[n];return r}(e);t.san=G(t,!1),t.to=se(t.to),t.from=se(t.from);var r="";for(var n in y)y[n]&t.flags&&(r+=b[n]);return t.flags=r,t}function le(e){return e.replace(/^\s+|\s+$/g,"")}return N(void 0===e?d:e),{WHITE:r,BLACK:t,PAWN:o,KNIGHT:i,BISHOP:s,ROOK:a,QUEEN:c,KING:l,SQUARES:function(){for(var e=[],t=_.a8;t<=_.h1;t++)136&t?t+=7:e.push(se(t));return e}(),FLAGS:b,load:function(e){return N(e)},reset:function(){return L()},moves:function(e){for(var t=W(e),r=[],n=0,o=t.length;n<o;n++)void 0!==e&&"verbose"in e&&e.verbose?r.push(ce(t[n])):r.push(G(t[n],!1));return r},in_check:function(){return z()},in_checkmate:function(){return Z()},in_stalemate:function(){return Y()},in_draw:function(){return x>=100||Y()||J()||ee()},insufficient_material:function(){return J()},in_threefold_repetition:function(){return ee()},game_over:function(){return x>=100||Z()||Y()||J()||ee()},validate_fen:function(e){return D(e)},fen:function(){return R()},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,n=[],o=!1;for(var i in I)n.push("["+i+' "'+I[i]+'"]'+t),o=!0;o&&j.length&&n.push(t);for(var s=[];j.length>0;)s.push(re());for(var a=[],c="";s.length>0;){var l=s.pop();j.length||"b"!==l.color?"w"===l.color&&(c.length&&a.push(c),c=q+"."):c=q+". ...",c=c+" "+G(l,!1),te(l)}if(c.length&&a.push(c),void 0!==I.Result&&a.push(I.Result),0===r)return n.join("")+a.join(" ");var u=0;for(i=0;i<a.length;i++)u+a[i].length>r&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(t),u=0):0!==i&&(n.push(" "),u++),n.push(a[i]),u+=a[i].length;return n.join("")},load_pgn:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy;function n(e){return e.replace(/\\/g,"\\")}var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i=new RegExp("^(\\[(.|"+n(o)+")*\\])("+n(o)+")*1.("+n(o)+"|.)*$","g"),s=e.replace(i,"$1");"["!==s[0]&&(s=""),L();var a=function(e,t){for(var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(n(r))),s="",a="",c=0;c<i.length;c++)s=i[c].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=i[c].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),le(s).length>0&&(o[s]=a);return o}(s,t);for(var c in a)K([c,a[c]]);if("1"===a.SetUp&&!("FEN"in a&&N(a.FEN)))return!1;var l=e.replace(s,"").replace(new RegExp(n(o),"g")," ");l=l.replace(/(\{[^}]+\})+?/g,"");for(var u=/(\([^\(\)]+\))+?/g;u.test(l);)l=l.replace(u,"");var d=le(l=(l=(l=l.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));d=d.join(",").replace(/,,+/g,",").split(",");for(var p="",h=0;h<d.length-1;h++){if(null==(p=ne(d[h],r)))return!1;te(p)}if(p=d[d.length-1],f.indexOf(p)>-1)(function(e){for(var t in e)return!0;return!1})(I)&&void 0===I.Result&&K(["Result",p]);else{if(null==(p=ne(p,r)))return!1;te(p)}return!0},header:function(){return K(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=_.a8;t<=_.h1;t++){if(0===ie(t)&&(e+=" "+"87654321"[oe(t)]+" |"),null==S[t])e+=" . ";else{var n=S[t].type;e+=" "+(S[t].color===r?n.toUpperCase():n.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return O},move:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy,n=null;if("string"==typeof e)n=ne(e,r);else if("object"==typeof e)for(var o=W(),i=0,s=o.length;i<s;i++)if(!(e.from!==se(o[i].from)||e.to!==se(o[i].to)||"promotion"in o[i]&&e.promotion!==o[i].promotion)){n=o[i];break}if(!n)return null;var a=ce(n);return te(n),a},undo:function(){var e=re();return e?ce(e):null},clear:function(){return F()},put:function(e,t){return Q(e,t)},get:function(e){return B(e)},remove:function(e){return function(e){var t=B(e);return S[_[e]]=null,t&&t.type===l&&(A[t.color]=n),U(R()),t}(e)},perft:function(e){return function e(t){for(var r=W({legal:!1}),n=0,o=O,i=0,s=r.length;i<s;i++){if(te(r[i]),!X(o))if(t-1>0)n+=e(t-1);else n++;re()}return n}(e)},square_color:function(e){if(e in _){var t=_[e];return(oe(t)+ie(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],r=[],n=(void 0!==e&&"verbose"in e&&e.verbose);j.length>0;)t.push(re());for(;t.length>0;){var o=t.pop();n?r.push(ce(o)):r.push(G(o)),te(o)}return r}}};void 0!==r&&(r.Chess=n)},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util");function o(e,t){const r=e(t);return t.dom.redraw(),r}function i(e,t){return{key:e,pos:n.key2pos(e),piece:t}}function s(e){for(let t in e)return!1;return!0}r.anim=function(e,t){return t.animation.enabled?function(e,t){const r=Object.assign({},t.pieces),o=e(t),a=function(e,t){const r={},o=[],s={},a=[],c=[],l={};let u,d,f,p;for(f in e)l[f]=i(f,e[f]);for(const e of n.allKeys)u=t.pieces[e],d=l[e],u?d?n.samePiece(u,d.piece)||(a.push(d),c.push(i(e,u))):c.push(i(e,u)):d&&a.push(d);return c.forEach(e=>{d=function(e,t){return t.sort((t,r)=>n.distanceSq(e.pos,t.pos)-n.distanceSq(e.pos,r.pos))[0]}(e,a.filter(t=>n.samePiece(e.piece,t.piece))),d&&(p=[d.pos[0]-e.pos[0],d.pos[1]-e.pos[1]],r[e.key]=p.concat(p),o.push(d.key))}),a.forEach(e=>{n.containsX(o,e.key)||(s[e.key]=e.piece)}),{anims:r,fadings:s}}(r,t);if(s(a.anims)&&s(a.fadings))t.dom.redraw();else{const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:a},e||function e(t,r){const n=t.animation.current;if(void 0===n)return void(t.dom.destroyed||t.dom.redrawNow());const o=1-(r-n.start)*n.frequency;if(o<=0)t.animation.current=void 0,t.dom.redrawNow();else{const r=(i=o)<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1;for(let e in n.plan.anims){const t=n.plan.anims[e];t[2]=t[0]*r,t[3]=t[1]*r}t.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>e(t,r))}var i}(t,performance.now())}return o}(e,t):o(e,t)},r.render=o},{"./util":18}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./board"),o=e("./fen"),i=e("./config"),s=e("./anim"),a=e("./drag"),c=e("./explosion");r.start=function(e,t){function r(){n.toggleOrientation(e),t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&r(),(t.fen?s.anim:s.render)(e=>i.configure(e,t),e)},state:e,getFen:()=>o.write(e.pieces),toggleOrientation:r,setPieces(t){s.anim(e=>n.setPieces(e,t),e)},selectSquare(t,r){t?s.anim(e=>n.selectSquare(e,t,r),e):e.selected&&(n.unselect(e),e.dom.redraw())},move(t,r){s.anim(e=>n.baseMove(e,t,r),e)},newPiece(t,r){s.anim(e=>n.baseNewPiece(e,t,r),e)},playPremove(){if(e.premovable.current){if(s.anim(n.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const r=n.playPredrop(e,t);return e.dom.redraw(),r}return!1},cancelPremove(){s.render(n.unsetPremove,e)},cancelPredrop(){s.render(n.unsetPredrop,e)},cancelMove(){s.render(e=>{n.cancelMove(e),a.cancel(e)},e)},stop(){s.render(e=>{n.stop(e),a.cancel(e)},e)},explode(t){c.default(e,t)},setAutoShapes(t){s.render(e=>e.drawable.autoShapes=t,e)},setShapes(t){s.render(e=>e.drawable.shapes=t,e)},getKeyAtDomPos:t=>n.getKeyAtDomPos(t,n.whitePov(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,r,n){a.dragNewPiece(e,t,r,n)},destroy(){n.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":2,"./board":4,"./config":6,"./drag":7,"./explosion":11,"./fen":12}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util"),o=e("./premove");function i(e,...t){e&&setTimeout(()=>e(...t),1)}function s(e){e.premovable.current&&(e.premovable.current=void 0,i(e.premovable.events.unset))}function a(e){const t=e.predroppable;t.current&&(t.current=void 0,i(t.events.unset))}function c(e,t,r){const o=e.pieces[t],s=e.pieces[r];if(t===r||!o)return!1;const a=s&&s.color!==o.color?s:void 0;return r==e.selected&&p(e),i(e.events.move,t,r,a),function(e,t,r){if(!e.autoCastle)return!1;const o=e.pieces[t];if(!o||"king"!==o.role)return!1;const i=n.key2pos(t);if(5!==i[0])return!1;if(1!==i[1]&&8!==i[1])return!1;const s=n.key2pos(r);let a,c,l;if(7===s[0]||8===s[0])a=n.pos2key([8,i[1]]),c=n.pos2key([6,i[1]]),l=n.pos2key([7,i[1]]);else{if(3!==s[0]&&1!==s[0])return!1;a=n.pos2key([1,i[1]]),c=n.pos2key([4,i[1]]),l=n.pos2key([3,i[1]])}const u=e.pieces[a];return!(!u||"rook"!==u.role)&&(delete e.pieces[t],delete e.pieces[a],e.pieces[l]=o,e.pieces[c]=u,!0)}(e,t,r)||(e.pieces[r]=o,delete e.pieces[t]),e.lastMove=[t,r],e.check=void 0,i(e.events.change),a||!0}function l(e,t,r,o){if(e.pieces[r]){if(!o)return!1;delete e.pieces[r]}return i(e.events.dropNewPiece,t,r),e.pieces[r]=t,e.lastMove=[r],e.check=void 0,i(e.events.change),e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),!0}function u(e,t,r){const o=c(e,t,r);return o&&(e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),e.animation.current=void 0),o}function d(e,t,r){if(v(e,t,r)){const n=u(e,t,r);if(n){const o=e.hold.stop();p(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==n&&(s.captured=n),i(e.movable.events.after,t,r,s),!0}}else if(function(e,t,r){return t!==r&&g(e,t)&&n.containsX(o.default(e.pieces,t,e.premovable.castle),r)}(e,t,r))return function(e,t,r,n){a(e),e.premovable.current=[t,r],i(e.premovable.events.set,t,r,n)}(e,t,r,{ctrlKey:e.stats.ctrlKey}),p(e),!0;return p(e),!1}function f(e,t){e.selected=t,g(e,t)?e.premovable.dests=o.default(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function p(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function h(e,t){const r=e.pieces[t];return!!r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function v(e,t,r){return t!==r&&h(e,t)&&(e.movable.free||!!e.movable.dests&&n.containsX(e.movable.dests[t],r))}function g(e,t){const r=e.pieces[t];return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function m(e){s(e),a(e),p(e)}r.callUserFunction=i,r.toggleOrientation=function(e){e.orientation=n.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},r.reset=function(e){e.lastMove=void 0,p(e),s(e),a(e)},r.setPieces=function(e,t){for(let r in t){const n=t[r];n?e.pieces[r]=n:delete e.pieces[r]}},r.setCheck=function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(let r in e.pieces)"king"===e.pieces[r].role&&e.pieces[r].color===t&&(e.check=r)},r.unsetPremove=s,r.unsetPredrop=a,r.baseMove=c,r.baseNewPiece=l,r.userMove=d,r.dropNewPiece=function(e,t,r,n){if(function(e,t,r){const n=e.pieces[t];return!!n&&r&&(t===r||!e.pieces[r])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,t,r)||n){const o=e.pieces[t];delete e.pieces[t],l(e,o,r,n),i(e.movable.events.afterNewPiece,o.role,r,{predrop:!1})}else!function(e,t,r){const n=e.pieces[t],o=e.pieces[r];return!!n&&r&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,r)?(s(e),a(e)):function(e,t,r){s(e),e.predroppable.current={role:t,key:r},i(e.predroppable.events.set,t,r)}(e,e.pieces[t].role,r);delete e.pieces[t],p(e)},r.selectSquare=function(e,t,r){if(i(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return p(e),void e.hold.cancel();if((e.selectable.enabled||r)&&e.selected!==t&&d(e,e.selected,t))return void(e.stats.dragged=!1)}(h(e,t)||g(e,t))&&(f(e,t),e.hold.start())},r.setSelected=f,r.unselect=p,r.canMove=v,r.isDraggable=function(e,t){const r=e.pieces[t];return!!r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))},r.playPremove=function(e){const t=e.premovable.current;if(!t)return!1;const r=t[0],n=t[1];let o=!1;if(v(e,r,n)){const t=u(e,r,n);if(t){const s={premove:!0};!0!==t&&(s.captured=t),i(e.movable.events.after,r,n,s),o=!0}}return s(e),o},r.playPredrop=function(e,t){let r=e.predroppable.current,n=!1;if(!r)return!1;if(t(r)){l(e,{role:r.role,color:e.movable.color},r.key)&&(i(e.movable.events.afterNewPiece,r.role,r.key,{predrop:!0}),n=!0)}return a(e),n},r.cancelMove=m,r.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,m(e)},r.getKeyAtDomPos=function(e,t,r){let o=Math.ceil((e[0]-r.left)/r.width*8);t||(o=9-o);let i=Math.ceil(8-(e[1]-r.top)/r.height*8);return t||(i=9-i),o>0&&o<9&&i>0&&i<9?n.pos2key([o,i]):void 0},r.whitePov=function(e){return"white"===e.orientation}},{"./premove":13,"./util":18}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./api"),o=e("./config"),i=e("./state"),s=e("./wrap"),a=e("./events"),c=e("./render"),l=e("./svg"),u=e("./util");function d(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}r.Chessground=function(e,t){const r=i.defaults();function f(){let t=r.dom&&r.dom.unbind;const n=r.viewOnly&&!r.drawable.visible,o=s.default(e,r,n),i=u.memo(()=>o.board.getBoundingClientRect()),p=e=>{c.default(r),!e&&o.svg&&l.renderSvg(r,o.svg)};r.dom={elements:o,bounds:i,redraw:d(p),redrawNow:p,unbind:t,relative:n},r.drawable.prevSvgHash="",p(!1),a.bindBoard(r),t||(r.dom.unbind=a.bindDocument(r,f)),r.events.insert&&r.events.insert(o)}return o.configure(r,t||{}),f(),n.start(r,f)}},{"./api":3,"./config":6,"./events":10,"./render":14,"./state":15,"./svg":16,"./util":18,"./wrap":19}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./board"),o=e("./fen");function i(e){return"object"==typeof e}r.configure=function(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),function e(t,r){for(let n in r)i(t[n])&&i(r[n])?e(t[n],r[n]):t[n]=r[n]}(e,t),t.fen&&(e.pieces=o.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&n.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&n.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?1:8,r="e"+t,n=e.movable.dests[r],o=e.pieces[r];if(!n||!o||"king"!==o.role)return;e.movable.dests[r]=n.filter(e=>!(e==="a"+t&&-1!==n.indexOf("c"+t)||e==="h"+t&&-1!==n.indexOf("g"+t)))}}},{"./board":4,"./fen":12}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./board"),o=e("./util"),i=e("./draw"),s=e("./anim");function a(e,t){const r=n.whitePov(e),i=e.dom.bounds(),s=Math.pow(i.width/8,2);for(let n in e.pieces){const e=d(n,r,i),a=[e.left+e.width/2,e.top+e.height/2];if(o.distanceSq(a,t)<=s)return!0}return!1}function c(e){requestAnimationFrame(()=>{const t=e.draggable.current;if(!t)return;e.animation.current&&e.animation.current.plan.anims[t.orig]&&(e.animation.current=void 0);const r=e.pieces[t.orig];if(r&&o.samePiece(r,t.piece)){if(!t.started&&o.distanceSq(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){const e=t.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),t.element=e}t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]];const r=o.posToTranslateAbs(e.dom.bounds())(t.origPos,n.whitePov(e));r[0]+=t.pos[0]+t.dec[0],r[1]+=t.pos[1]+t.dec[1],o.translateAbs(t.element,r)}}else l(e);c(e)})}function l(e){const t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,n.unselect(e),u(e),e.dom.redraw())}function u(e){const t=e.dom.elements;t.ghost&&o.setVisible(t.ghost,!1)}function d(e,t,r){const n=o.key2pos(e);return t||(n[0]=9-n[0],n[1]=9-n[1]),{left:r.left+r.width*(n[0]-1)/8,top:r.top+r.height*(8-n[1])/8,width:r.width/8,height:r.height/8}}function f(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}r.start=function(e,t){if(void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const r=e.dom.bounds(),l=o.eventPosition(t),u=n.getKeyAtDomPos(l,n.whitePov(e),r);if(!u)return;const p=e.pieces[u],h=e.selected;h||!e.drawable.enabled||!e.drawable.eraseOnClick&&p&&p.color===e.turnColor||i.clear(e),!1===t.cancelable||t.touches&&e.movable.color&&!p&&!h&&!a(e,l)||t.preventDefault();const v=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&n.canMove(e,e.selected,u)?s.anim(e=>n.selectSquare(e,u),e):n.selectSquare(e,u);const m=e.selected===u,b=f(e,u);if(p&&b&&m&&n.isDraggable(e,u)){const i=d(u,n.whitePov(e),r);e.draggable.current={orig:u,origPos:o.key2pos(u),piece:p,rel:l,epos:l,pos:[0,0],dec:e.draggable.centerPiece?[l[0]-(i.left+i.width/2),l[1]-(i.top+i.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:h,originTarget:t.target},b.cgDragging=!0,b.classList.add("dragging");const s=e.dom.elements.ghost;s&&(s.className=`ghost ${p.color} ${p.role}`,o.translateAbs(s,o.posToTranslateAbs(r)(o.key2pos(u),n.whitePov(e))),o.setVisible(s,!0)),c(e)}else v&&n.unsetPremove(e),g&&n.unsetPredrop(e);e.dom.redraw()},r.pieceCloseTo=a,r.dragNewPiece=function(e,t,r,i){e.pieces.a0=t,e.dom.redraw();const s=o.eventPosition(r),a=n.whitePov(e),l=e.dom.bounds(),u=d("a0",a,l),p=[(a?0:7)*u.width+l.left,(a?8:-1)*u.height+l.top];e.draggable.current={orig:"a0",origPos:o.key2pos("a0"),piece:t,rel:p,epos:s,pos:[s[0]-p[0],s[1]-p[1]],dec:[-u.width/2,-u.height/2],started:!0,element:()=>f(e,"a0"),originTarget:r.target,newPiece:!0,force:!!i},c(e)},r.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=o.eventPosition(t))},r.end=function(e,t){const r=e.draggable.current;if(!r)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&r&&r.originTarget!==t.target&&!r.newPiece)return void(e.draggable.current=void 0);n.unsetPremove(e),n.unsetPredrop(e);const i=o.eventPosition(t)||r.epos,s=n.getKeyAtDomPos(i,n.whitePov(e),e.dom.bounds());s&&r.started&&r.orig!==s?r.newPiece?n.dropNewPiece(e,r.orig,s,r.force):(e.stats.ctrlKey=t.ctrlKey,n.userMove(e,r.orig,s)&&(e.stats.dragged=!0)):r.newPiece?delete e.pieces[r.orig]:e.draggable.deleteOnDropOff&&!s&&(delete e.pieces[r.orig],n.callUserFunction(e.events.change)),(!r||r.orig!==r.previouslySelected||r.orig!==s&&s)&&e.selectable.enabled||n.unselect(e),u(e),e.draggable.current=void 0,e.dom.redraw()},r.cancel=l},{"./anim":2,"./board":4,"./draw":8,"./util":18}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./board"),o=e("./util"),i=["green","red","blue","yellow"];function s(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const r=n.getKeyAtDomPos(t.pos,n.whitePov(e),e.dom.bounds());r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),s(e)}})}function a(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function c(e){return i[(e.shiftKey&&o.isRightButton(e)?1:0)+(e.altKey?2:0)]}function l(e){e.onChange&&e.onChange(e.shapes)}r.start=function(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?n.unselect(e):n.cancelMove(e);const r=o.eventPosition(t),i=n.getKeyAtDomPos(r,n.whitePov(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:r,brush:c(t)},s(e))},r.processDraw=s,r.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=o.eventPosition(t))},r.end=function(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const r=e=>e.orig===t.orig&&e.dest===t.dest,n=e.shapes.filter(r)[0];n&&(e.shapes=e.shapes.filter(e=>!r(e)));n&&n.brush===t.brush||e.shapes.push(t);l(e)}(e.drawable,t),a(e))},r.cancel=a,r.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),l(e.drawable))}},{"./board":4,"./util":18}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./board"),o=e("./util"),i=e("./drag");r.setDropMode=function(e,t){e.dropmode={active:!0,piece:t},i.cancel(e)},r.cancelDropMode=function(e){e.dropmode={active:!1}},r.drop=function(e,t){if(!e.dropmode.active)return;n.unsetPremove(e),n.unsetPredrop(e);const r=e.dropmode.piece;if(r){e.pieces.a0=r;const i=o.eventPosition(t),s=i&&n.getKeyAtDomPos(i,n.whitePov(e),e.dom.bounds());s&&n.dropNewPiece(e,"a0",s)}e.dom.redraw()}},{"./board":4,"./drag":7,"./util":18}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./drag"),o=e("./draw"),i=e("./drop"),s=e("./util");function a(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function c(e,t,r){return n=>{n.shiftKey||s.isRightButton(n)?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)}}r.bindBoard=function(e){if(e.viewOnly)return;const t=e.dom.elements.board,r=function(e){return t=>{e.draggable.current?n.cancel(e):e.drawable.current?o.cancel(e):t.shiftKey||s.isRightButton(t)?e.drawable.enabled&&o.start(e,t):e.viewOnly||(e.dropmode.active?i.drop(e,t):n.start(e,t))}}(e);t.addEventListener("touchstart",r,{passive:!1}),t.addEventListener("mousedown",r,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",e=>e.preventDefault())},r.bindDocument=function(e,t){const r=[];if(!e.dom.relative&&e.resizable){const n=()=>{e.dom.bounds.clear(),requestAnimationFrame(t)};r.push(a(document.body,"chessground.resize",n))}if(!e.viewOnly){const t=c(e,n.move,o.move),i=c(e,n.end,o.end);["touchmove","mousemove"].forEach(e=>r.push(a(document,e,t))),["touchend","mouseup"].forEach(e=>r.push(a(document,e,i)));const s=()=>e.dom.bounds.clear();r.push(a(window,"scroll",s,{passive:!0})),r.push(a(window,"resize",s,{passive:!0}))}return()=>r.forEach(e=>e())}},{"./drag":7,"./draw":8,"./drop":9,"./util":18}],11:[function(e,t,r){"use strict";function n(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{n(e,2),setTimeout(()=>n(e,void 0),120)},120)}},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util"),o=e("./types");r.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";const i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},s={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};r.read=function(e){"start"===e&&(e=r.initial);const t={};let o=8,s=0;for(const r of e)switch(r){case" ":return t;case"/":if(--o,0===o)return t;s=0;break;case"~":const e=t[n.pos2key([s,o])];e&&(e.promoted=!0);break;default:const a=r.charCodeAt(0);if(a<57)s+=a-48;else{++s;const e=r.toLowerCase();t[n.pos2key([s,o])]={role:i[e],color:r===e?"black":"white"}}}return t},r.write=function(e){return n.invRanks.map(t=>o.ranks.map(r=>{const o=e[n.pos2key([r,t])];if(o){const e=s[o.role];return"white"===o.color?e.toUpperCase():e}return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}},{"./types":17,"./util":18}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util");function o(e,t){return Math.abs(e-t)}const i=(e,t,r,n)=>{const i=o(e,r),s=o(t,n);return 1===i&&2===s||2===i&&1===s},s=(e,t,r,n)=>o(e,r)===o(t,n),a=(e,t,r,n)=>e===r||t===n,c=(e,t,r,n)=>s(e,t,r,n)||a(e,t,r,n);const l=n.allKeys.map(n.key2pos);r.default=function(e,t,r){const u=e[t],d=n.key2pos(t),f=u.role,p="pawn"===f?(h=u.color,(e,t,r,n)=>o(e,r)<2&&("white"===h?n===t+1||t<=2&&n===t+2&&e===r:n===t-1||t>=7&&n===t-2&&e===r)):"knight"===f?i:"bishop"===f?s:"rook"===f?a:"queen"===f?c:function(e,t,r){return(i,s,a,c)=>o(i,a)<2&&o(s,c)<2||r&&s===c&&s===("white"===e?1:8)&&(5===i&&(3===a||7===a)||n.containsX(t,a))}(u.color,function(e,t){return Object.keys(e).filter(r=>{const n=e[r];return n&&n.color===t&&"rook"===n.role}).map(e=>n.key2pos(e)[0])}(e,u.color),r);var h;return l.filter(e=>(d[0]!==e[0]||d[1]!==e[1])&&p(d[0],d[1],e[0],e[1])).map(n.pos2key)}},{"./util":18}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util"),o=e("./board"),i=e("./util");function s(e){return"PIECE"===e.tagName}function a(e){return"SQUARE"===e.tagName}function c(e,t){for(const r in t)e.dom.elements.board.removeChild(t[r])}function l(e,t){let r=2+8*(e[1]-1)+(8-e[0]);return t&&(r=67-r),r+""}function u(e){return`${e.color} ${e.role}`}function d(e,t,r){e[t]?e[t]+=" "+r:e[t]=r}r.default=function(e){const t=o.whitePov(e),r=e.dom.relative?i.posToTranslateRel:i.posToTranslateAbs(e.dom.bounds()),f=e.dom.relative?i.translateRel:i.translateAbs,p=e.dom.elements.board,h=e.pieces,v=e.animation.current,g=v?v.plan.anims:{},m=v?v.plan.fadings:{},b=e.draggable.current,y=function(e){const t={};let r,n;if(e.lastMove&&e.highlight.lastMove)for(r in e.lastMove)d(t,e.lastMove[r],"last-move");e.check&&e.highlight.check&&d(t,e.check,"check");if(e.selected&&(d(t,e.selected,"selected"),e.movable.showDests)){const o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(r in o)n=o[r],d(t,n,"move-dest"+(e.pieces[n]?" oc":""));const i=e.premovable.dests;if(i)for(r in i)n=i[r],d(t,n,"premove-dest"+(e.pieces[n]?" oc":""))}const o=e.premovable.current;if(o)for(r in o)d(t,o[r],"current-premove");else e.predroppable.current&&d(t,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(r in i.keys)d(t,i.keys[r],"exploding"+i.stage);return t}(e),w={},P={},k={},E={},_=Object.keys(h);let C,S,A,O,M,T,x,q,j,I,F;for(A=p.firstChild;A;){if(C=A.cgKey,s(A))if(O=h[C],T=g[C],x=m[C],M=A.cgPiece,!A.cgDragging||b&&b.orig===C||(A.classList.remove("dragging"),f(A,r(n.key2pos(C),t)),A.cgDragging=!1),!x&&A.cgFading&&(A.cgFading=!1,A.classList.remove("fading")),O){if(T&&A.cgAnimating&&M===u(O)){const e=n.key2pos(C);e[0]+=T[2],e[1]+=T[3],A.classList.add("anim"),f(A,r(e,t))}else A.cgAnimating&&(A.cgAnimating=!1,A.classList.remove("anim"),f(A,r(n.key2pos(C),t)),e.addPieceZIndex&&(A.style.zIndex=l(n.key2pos(C),t)));M!==u(O)||x&&A.cgFading?x&&M===u(x)?(A.classList.add("fading"),A.cgFading=!0):k[M]?k[M].push(A):k[M]=[A]:w[C]=!0}else k[M]?k[M].push(A):k[M]=[A];else if(a(A)){const e=A.className;y[C]===e?P[C]=!0:E[e]?E[e].push(A):E[e]=[A]}A=A.nextSibling}for(const e in y)if(!P[e]){I=E[y[e]],F=I&&I.pop();const o=r(n.key2pos(e),t);if(F)F.cgKey=e,f(F,o);else{const t=n.createEl("square",y[e]);t.cgKey=e,f(t,o),p.insertBefore(t,p.firstChild)}}for(const o in _)if(C=_[o],S=h[C],T=g[C],!w[C])if(q=k[u(S)],j=q&&q.pop(),j){j.cgKey=C,j.cgFading&&(j.classList.remove("fading"),j.cgFading=!1);const o=n.key2pos(C);e.addPieceZIndex&&(j.style.zIndex=l(o,t)),T&&(j.cgAnimating=!0,j.classList.add("anim"),o[0]+=T[2],o[1]+=T[3]),f(j,r(o,t))}else{const o=u(S),i=n.createEl("piece",o),s=n.key2pos(C);i.cgPiece=o,i.cgKey=C,T&&(i.cgAnimating=!0,s[0]+=T[2],s[1]+=T[3]),f(i,r(s,t)),e.addPieceZIndex&&(i.style.zIndex=l(s,t)),p.appendChild(i)}for(const t in k)c(e,k[t]);for(const t in E)c(e,E[t])}},{"./board":4,"./util":18}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./fen"),o=e("./util");r.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":12,"./util":18}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util");function o(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function i({orig:e,dest:t,brush:r,piece:n,modifiers:o},i,a){return[a,e,t,r,t&&i[t]>1,n&&s(n),o&&(c=o,""+(c.lineWidth||""))].filter(e=>e).join("");var c}function s(e){return[e.color,e.role,e.scale].filter(e=>e).join("")}function a(e){const t=c(o("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(c(o("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function c(e,t){for(let r in t)e.setAttribute(r,t[r]);return e}function l(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function u(e,t){const r={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return r.key=[e.key,t.lineWidth].filter(e=>e).join(""),r}function d(e,t,r){return(e.lineWidth||10)*(t?.85:1)/512*r.width}function f(e,t){return(e.opacity||1)*(t?.9:1)}function p(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}r.createElement=o,r.renderSvg=function(e,t){const r=e.drawable,s=r.current,h=s&&s.mouseSq?s:void 0,v={};r.shapes.concat(r.autoShapes).concat(h?[h]:[]).forEach(e=>{e.dest&&(v[e.dest]=(v[e.dest]||0)+1)});const g=r.shapes.concat(r.autoShapes).map(e=>({shape:e,current:!1,hash:i(e,v,!1)}));h&&g.push({shape:h,current:!0,hash:i(h,v,!0)});const m=g.map(e=>e.hash).join("");if(m===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=m;const b=t.firstChild;!function(e,t,r){const n={};let o;t.forEach(t=>{t.shape.dest&&(o=e.brushes[t.shape.brush],t.shape.modifiers&&(o=u(o,t.shape.modifiers)),n[o.key]=o)});const i={};let s=r.firstChild;for(;s;)i[s.getAttribute("cgKey")]=!0,s=s.nextSibling;for(let e in n)i[e]||r.appendChild(a(n[e]))}(r,g,b),function(e,t,r,i,s,a){const h=e.dom.bounds(),v={},g=[];t.forEach(e=>{v[e.hash]=!1});let m,b=a.nextSibling;for(;b;)m=b.getAttribute("cgHash"),v.hasOwnProperty(m)?v[m]=!0:g.push(b),b=b.nextSibling;g.forEach(e=>s.removeChild(e)),t.forEach(t=>{v[t.hash]||s.appendChild(function(e,{shape:t,current:r,hash:i},s,a,h){let v;if(t.piece)v=function(e,t,r,n){const i=p(t,n),s=n.width/8*(r.scale||1),a=r.color[0]+("knight"===r.role?"n":r.role[0]).toUpperCase();return c(o("image"),{className:`${r.role} ${r.color}`,x:i[0]-s/2,y:i[1]-s/2,width:s,height:s,href:e+a+".svg"})}(e.drawable.pieces.baseUrl,l(n.key2pos(t.orig),e.orientation),t.piece,h);else{const i=l(n.key2pos(t.orig),e.orientation);if(t.orig&&t.dest){let g=s[t.brush];t.modifiers&&(g=u(g,t.modifiers)),v=function(e,t,r,n,i,s){const a=function(e,t){return(t?20:10)/512*e.width}(s,i&&!n),l=p(t,s),u=p(r,s),h=u[0]-l[0],v=u[1]-l[1],g=Math.atan2(v,h),m=Math.cos(g)*a,b=Math.sin(g)*a;return c(o("line"),{stroke:e.color,"stroke-width":d(e,n,s),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:f(e,n),x1:l[0],y1:l[1],x2:u[0]-m,y2:u[1]-b})}(g,i,l(n.key2pos(t.dest),e.orientation),r,a[t.dest]>1,h)}else v=function(e,t,r,n){const i=p(t,n),s=function(e){const t=e.width/512;return[3*t,4*t]}(n),a=(n.width+n.height)/32;return c(o("circle"),{stroke:e.color,"stroke-width":s[r?0:1],fill:"none",opacity:f(e,r),cx:i[0],cy:i[1],r:a-s[1]/2})}(s[t.brush],i,r,h)}return v.setAttribute("cgHash",i),v}(e,t,r,i,h))})}(e,g,r.brushes,v,t,b)}},{"./util":18}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.files=["a","b","c","d","e","f","g","h"],r.ranks=[1,2,3,4,5,6,7,8]},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./types");r.colors=["white","black"],r.invRanks=[8,7,6,5,4,3,2,1],r.allKeys=Array.prototype.concat(...n.files.map(e=>n.ranks.map(t=>e+t))),r.pos2key=e=>r.allKeys[8*e[0]+e[1]-9],r.key2pos=e=>[e.charCodeAt(0)-96,e.charCodeAt(1)-48],r.memo=function(e){let t;const r=()=>(void 0===t&&(t=e()),t);return r.clear=()=>{t=void 0},r},r.timer=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},r.opposite=e=>"white"===e?"black":"white",r.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)},r.distanceSq=(e,t)=>Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2),r.samePiece=(e,t)=>e.role===t.role&&e.color===t.color;const o=(e,t,r,n)=>[(t?e[0]-1:8-e[0])*r,(t?8-e[1]:e[1]-1)*n];r.posToTranslateAbs=e=>{const t=e.width/8,r=e.height/8;return(e,n)=>o(e,n,t,r)},r.posToTranslateRel=(e,t)=>o(e,t,12.5,12.5),r.translateAbs=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},r.translateRel=(e,t)=>{e.style.left=t[0]+"%",e.style.top=t[1]+"%"},r.setVisible=(e,t)=>{e.style.visibility=t?"visible":"hidden"},r.eventPosition=e=>e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0,r.isRightButton=e=>2===e.buttons||2===e.button,r.createEl=(e,t)=>{const r=document.createElement(e);return t&&(r.className=t),r}},{"./types":17}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./util"),o=e("./types"),i=e("./svg");function s(e,t){const r=n.createEl("coords",t);let o;for(let t in e)o=n.createEl("coord"),o.textContent=e[t],r.appendChild(o);return r}r.default=function(e,t,r){e.innerHTML="",e.classList.add("cg-wrap"),n.colors.forEach(r=>e.classList.toggle("orientation-"+r,t.orientation===r)),e.classList.toggle("manipulable",!t.viewOnly);const a=n.createEl("cg-helper");e.appendChild(a);const c=n.createEl("cg-container");a.appendChild(c);const l=n.createEl("cg-board");let u,d;if(c.appendChild(l),t.drawable.visible&&!r&&(u=i.createElement("svg"),u.appendChild(i.createElement("defs")),c.appendChild(u)),t.coordinates){const e="black"===t.orientation?" black":"";c.appendChild(s(o.ranks,"ranks"+e)),c.appendChild(s(o.files,"files"+e))}return t.draggable.showGhost&&!r&&(d=n.createEl("piece","ghost"),n.setVisible(d,!1),c.appendChild(d)),{board:l,container:c,ghost:d,svg:u}}},{"./svg":16,"./types":17,"./util":18}],20:[function(e,t,r){var n,o,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var l,u=[],d=!1,f=-1;function p(){d&&l&&(d=!1,l.length?u=l.concat(u):f=-1,u.length&&h())}function h(){if(!d){var e=c(p);d=!0;for(var t=u.length;t;){for(l=u,u=[];++f<t;)l&&l[f].run();f=-1,t=u.length}l=null,d=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new v(e,t)),1!==u.length||d||c(h)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],21:[function(e,t,r){(function(r){"use strict";"production"===r.env.NODE_ENV?t.exports=e("./search-params.cjs.production.min.js"):t.exports=e("./search-params.cjs.development.js")}).call(this,e("_process"))},{"./search-params.cjs.development.js":22,"./search-params.cjs.production.min.js":23,_process:20}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},o=function(e){return encodeURIComponent(e)},i=function(e){return decodeURIComponent(e)},s=function(e,t,r){return null===t?function(e,t){return"hidden"===t.nullFormat?"":"string"===t.nullFormat?e+"=null":e}(e,r):"boolean"==typeof t?function(e,t,r){return"empty-true"===r.booleanFormat&&t?e:e+"="+("unicode"===r.booleanFormat?t?"✓":"✗":t.toString())}(e,t,r):Array.isArray(t)?function(e,t,r){var n=function(e){return"index"===e.arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}}(r);return t.map((function(t,r){return n(e,r)+"="+o(t)})).join("&")}(e,t,r):e+"="+o(t)},a=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},c=function(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}},l=function(e,t){var r=n(t);return a(e).split("&").reduce((function(e,t){var n=t.split("="),o=n[0],s=n[1],a=c(o),l=a.hasBrackets,u=a.name,d=e[u],f=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}if("unicode"===t.booleanFormat){if("✓"===i(e))return!0;if("✗"===i(e))return!1}return"string"===t.nullFormat&&"null"===e?null:i(e)}(s,r);return e[u]=void 0===d?l?[f]:f:(Array.isArray(d)?d:[d]).concat(f),e}),{})};r.build=function(e,t){var r=n(t);return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return s(t,e[t],r)})).filter(Boolean).join("&")},r.keep=function(e,t,r){var o=n(r);if(""===a(e))return{keptParams:{},querystring:""};var i=e.split("&").reduce((function(e,r){var n=r.split("=")[0],o=c(n).name;return t.includes(o)&&e.push(r),e}),[]);return{keptParams:l(i.join("&"),o),querystring:i.join("&")}},r.omit=function(e,t,r){var o=n(r);if(""===a(e))return{querystring:"",removedParams:{}};var i=e.split("&").reduce((function(e,r){var n=e[0],o=e[1],i=r.split("=")[0],s=c(i).name;return-1===t.indexOf(s)?[n.concat(r),o]:[n,o.concat(r)]}),[[],[]]),s=i[0],u=i[1];return{querystring:s.join("&"),removedParams:l(u.join("&"),o)}},r.parse=l},{}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},o=function(e){return encodeURIComponent(e)},i=function(e){return decodeURIComponent(e)},s=function(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)},a=function(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}},c=function(e,t){var r=n(t);return s(e).split("&").reduce((function(e,t){var n=t.split("="),o=n[1],s=a(n[0]),c=s.hasBrackets,l=s.name,u=e[l],d=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}if("unicode"===t.booleanFormat){if("✓"===i(e))return!0;if("✗"===i(e))return!1}return"string"===t.nullFormat&&"null"===e?null:i(e)}(o,r);return e[l]=void 0===u?c?[d]:d:(Array.isArray(u)?u:[u]).concat(d),e}),{})};r.build=function(e,t){var r=n(t);return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return function(e,t,r){return null===t?function(e,t){return"hidden"===t.nullFormat?"":"string"===t.nullFormat?e+"=null":e}(e,r):"boolean"==typeof t?function(e,t,r){return"empty-true"===r.booleanFormat&&t?e:e+"="+("unicode"===r.booleanFormat?t?"✓":"✗":t.toString())}(e,t,r):Array.isArray(t)?function(e,t,r){var n=function(e){return"index"===e.arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}}(r);return t.map((function(t,r){return n(e,r)+"="+o(t)})).join("&")}(e,t,r):e+"="+o(t)}(t,e[t],r)})).filter(Boolean).join("&")},r.keep=function(e,t,r){var o=n(r);if(""===s(e))return{keptParams:{},querystring:""};var i=e.split("&").reduce((function(e,r){var n=r.split("=")[0],o=a(n).name;return t.includes(o)&&e.push(r),e}),[]);return{keptParams:c(i.join("&"),o),querystring:i.join("&")}},r.omit=function(e,t,r){var o=n(r);if(""===s(e))return{querystring:"",removedParams:{}};var i=e.split("&").reduce((function(e,r){var n=e[0],o=e[1],i=r.split("=")[0],s=a(i).name;return-1===t.indexOf(s)?[n.concat(r),o]:[n,o.concat(r)]}),[[],[]]),l=i[1];return{querystring:i[0].join("&"),removedParams:c(l.join("&"),o)}},r.parse=c},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./stockfishqueue"),o=e("./generator"),i=e("./shapes"),s=e("./util"),a=e("./ui"),c=e("chess.js");r.AnalysisBoard=class{constructor(e,t){this.shapes=new i.Shapes,this.positionMap={},this.stockfishQueue=new n.StockfishQueue(e,()=>this.allComplete(),({})=>{}),this.chessground=t}config(e){return{fen:e,drawable:{enabled:!1},selectable:{enabled:!1},highlight:{lastMove:!0,check:!1},draggable:{deleteOnDropOff:!0},movable:{events:{after:()=>a.Ui.setFen(s.Util.repairFen(this.chessground.getFen(),a.Ui.sideToPlay()))}}}}allComplete(){let e={win:0,lose:0,drawn:0};Object.keys(this.positionMap).forEach(t=>{let r=this.positionMap[t];r&&r.score&&e[r.score]++}),a.Ui.setStatus(`Perturbing piece on ${a.Ui.perturbed()} results in positions with ${e.win} wins, ${e.lose} loses and ${e.drawn} draws.`),this.updateExplorerView()}perturb(e,t){this.clear(),this.positionMap={},this.chessground.set(this.config(e));var r=new o.Generator(e).perturb(t);r.sort((e,r)=>s.Util.distance(e.targetSquare,t)-s.Util.distance(r.targetSquare,t)),r.forEach(e=>{this.positionMap[e.targetSquare]=e,this.stockfishQueue.enqueue(e,e=>{this.annotate(e)})})}updateExplorerView(){var e=(new c.Chess).SQUARES,t="";e.forEach(e=>{let r=this.positionMap[e],n=r?e:"-",o=r?r.targetSquare:"",i="explorer "+(r&&r.score?r.score:"");t+=a.Ui.button(n,i,`showFenAndPv('${o}')`),e.includes("h")&&(t+="<br/>")}),a.Ui.setExplorerView(t)}depth(e){this.stockfishQueue.depth=e}selectMode(e){this.onSelect=e,this.chessground.set({movable:{color:void 0},events:{select:e=>this.selectPerturbedPiece(e)}})}placePieceMode(e,t){this.chessground.set({movable:{color:void 0},events:{select:r=>this.addPiece({type:e,color:t},r)}})}addPiece(e,t){var r=this.chessground.getFen()+" w - - 0 2",n=new c.Chess(r);n.put(e,t),this.showFen(n.fen()),this.chessground.set({movable:{color:"both"},events:{select:void 0}})}selectPerturbedPiece(e){this.chessground.set({lastMove:[e],movable:{color:"both"},events:{select:void 0}}),this.onSelect(e)}clear(){this.shapes.clear(),this.chessground.setShapes(this.shapes.shapes)}fenForTarget(e){return this.positionMap[e].fen}showFenAndPv(e){let t=this.positionMap[e],r=this.shapes.pv(t);this.chessground.set({fen:t.fen}),this.chessground.setShapes([...this.shapes.shapes,...r])}showFen(e){this.chessground.set({fen:e}),a.Ui.setFen(e)}annotate(e){this.shapes.annotate(e),this.chessground.setShapes(this.shapes.shapes)}}},{"./generator":26,"./shapes":29,"./stockfishqueue":30,"./ui":31,"./util":32,"chess.js":1}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});class n{constructor(e){this.event=e}isComplete(){return!!n.completePattern.exec(this.event)}bestMove(){var e=n.completePattern.exec(this.event);return e?e[1]:""}pv(){var e=n.pvPattern.exec(this.event);return e?e[1].split(" "):[]}score(){var e=n.matePattern.exec(this.event);return e?this.scoreMate(e[1]):(e=n.centipawnPattern.exec(this.event))?this.scoreCp(e[1]):"noScore"}scoreCp(e){return e<150&&e>-150?"drawn":e>0?"win":"lose"}scoreMate(e){return e>0?"win":"lose"}}r.Event=n,n.matePattern=/score mate ([^ ]*) .*/,n.centipawnPattern=/score cp ([^ ]*) .*/,n.completePattern=/bestmove (....)/,n.pvPattern=/ pv (.*)/},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("chess.js"),o=e("./position"),i=e("./util");r.Generator=class{constructor(e){this.chess=new n.Chess(e)}perturb(e){const t=this.chess.get(e);if(!t)return[];const r=new n.Chess(this.chess.fen());r.remove(e);var i=[];return this.candidateSquares(t).forEach(e=>{const n=this.validFen(t,e,r);n&&i.push(new o.Position(n,e))}),i}candidateSquares(e){return"p"==e.type?this.chess.SQUARES.filter(e=>/.[2-7]/.test(e)):this.chess.SQUARES}validFen(e,t,r){if(!r.get(t)){r.put(e,t);const n=r.fen(),o=r.in_check(),i=r.in_stalemate();if(r.remove(t),!o&&!i&&this.validForOtherSide(n))return n}}validForOtherSide(e){return!new n.Chess(i.Util.fenForOtherSide(e)).in_check()}}},{"./position":28,"./util":32,"chess.js":1}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./stockfishqueue");r.StockfishQueue=n.StockfishQueue;var o=e("./generator");r.Generator=o.Generator;var i=e("./position");r.Position=i.Position;var s=e("./analysisboard");r.AnalysisBoard=s.AnalysisBoard;var a=e("./ui");r.Ui=a.Ui;var c=e("./util");r.Util=c.Util;var l=e("chessground");r.Chessground=l.Chessground;var u=e("search-params");r.parse=u.parse,r.build=u.build},{"./analysisboard":24,"./generator":26,"./position":28,"./stockfishqueue":30,"./ui":31,"./util":32,chessground:5,"search-params":21}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.Position=class{constructor(e,t){this.fen=e,this.targetSquare=t}}},{}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.Shapes=class{constructor(){this.shapes=[]}clear(){this.shapes=[]}annotate(e){this.shapes.push(this.circle(e))}circle(e){return{orig:e.targetSquare,brush:this.brush(e.score)}}pv(e){return e.pv.slice(0,4).map((t,r)=>this.line(t,Math.max((16-r)/2,2),r%2==0?this.brush(e.score):this.altBrush(e.score)))}line(e,t,r){return{orig:e.substring(0,2),dest:e.substring(2,4),brush:r,modifiers:{lineWidth:t}}}altBrush(e){switch(e){case"win":return"red";case"lose":return"green";default:return"blue"}}brush(e){switch(e){case"win":return"green";case"lose":return"red";case"drawn":return"yellow";default:return"blue"}}}},{}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./event");class o{constructor(e,t){this.position=e,this.onComplete=t}}r.StockfishQueue=class{constructor(e,t,r){this.workItems=[],this.stockfish=e,this.allComplete=t,this.log=r,this.depth=8,this.send("setoption name MultiPV value 1"),this.stockfish.addEventListener("message",e=>{this.sfEventHandler(e.data)})}sfEventHandler(e){const t=new n.Event(e);if(0!=this.workItems.length){if(t.isComplete()){let e=this.workItems.shift();return e.position.bestMove=t.bestMove(),this.log(e.position),e.onComplete(e.position),void(this.workItems.length>0?this.processNextWorkItem():this.allComplete())}var r=t.score();if("noScore"!=r)return this.workItems[0].position.score=r,void(this.workItems[0].position.pv=t.pv());this.log("ignored event: "+e)}}enqueue(e,t){this.workItems.push(new o(e,t)),1==this.workItems.length&&this.processNextWorkItem()}processNextWorkItem(){let e=this.workItems[0].position.fen;this.send("position fen "+e),this.send("go depth "+this.depth)}send(e){this.stockfish.postMessage(e),this.log(e)}}},{"./event":25}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.Ui=class{static setStatus(e,t){let r=document.getElementById("status");r&&(r.innerHTML=e,r.style.backgroundColor=t||"black")}static setExplorerView(e){let t=document.getElementById("explorer");t&&(t.innerHTML=e)}static setFen(e){let t=document.getElementById("fen");t&&(t.value=e)}static button(e,t,r){return`<button class="${t}" type="button" onClick="${r}">${e}</button>`}static sideToPlay(){return document.getElementById("colour").checked?"w":"b"}static perturbed(){return document.getElementById("perturb").value}}},{}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});class n{static fullFen(e){return 4==e.trim().split(" ").length?e.includes(" w ")?e+" 0 2":e+" 0 1":e}static fenForOtherSide(e){return e.includes(" w ")?e.replace(/ w .*/," b - - 0 1"):e.replace(/ b .*/," w - - 0 2")}static coordinates(e){return{x:e.charCodeAt(0)-"a".charCodeAt(0)+1,y:Number(e.substring(1,2))}}static distance(e,t){let r=n.coordinates(e),o=n.coordinates(t);return Math.max(Math.abs(r.x-o.x),Math.abs(r.y-o.y))}static repairFen(e,t){return e.split(" ")[0]+("w"==t?" w - - 0 2":" b - - 0 1")}}r.Util=n},{}]},{},[27])(27)}));