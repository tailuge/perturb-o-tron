!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=e()}}((function(){return function e(r,t,n){function o(a,s){if(!t[a]){if(!r[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=t[a]={exports:{}};r[a][0].call(l.exports,(function(e){return o(r[a][1][e]||e)}),l,l.exports,e,r,t,n)}return t[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,r,t){
/* @license
 * Copyright (c) 2016, Jeff Hlywa (jhlywa@gmail.com)
 * Released under the BSD license
 * https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var n=function(e){var r="b",t="w",n=-1,o="p",i="n",a="b",s="r",u="q",c="k",l="pnbrqkPNBRQK",f="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",d=["1-0","0-1","1/2-1/2","*"],p={b:[16,32,17,15],w:[-16,-32,-17,-15]},v={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},h=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],g=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],m={p:0,n:1,b:2,r:3,q:4,k:5},b={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},w=7,k=6,P=1,E=0,_={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},S={w:[{square:_.a1,flag:y.QSIDE_CASTLE},{square:_.h1,flag:y.KSIDE_CASTLE}],b:[{square:_.a8,flag:y.QSIDE_CASTLE},{square:_.h8,flag:y.KSIDE_CASTLE}]},C=new Array(128),A={w:n,b:n},O=t,M={w:0,b:0},T=n,x=0,I=1,j=[],q={};function L(){C=new Array(128),A={w:n,b:n},O=t,M={w:0,b:0},T=n,x=0,I=1,j=[],q={},U(D())}function F(){N(f)}function N(e){var o=e.split(/\s+/),i=o[0],a=0;if(!R(e).valid)return!1;L();for(var s=0;s<i.length;s++){var u=i.charAt(s);if("/"===u)a+=8;else if(-1!=="0123456789".indexOf(u))a+=parseInt(u,10);else{var c=u<"a"?t:r;Q({type:u.toLowerCase(),color:c},ae(a)),a++}}return O=o[1],o[2].indexOf("K")>-1&&(M.w|=y.KSIDE_CASTLE),o[2].indexOf("Q")>-1&&(M.w|=y.QSIDE_CASTLE),o[2].indexOf("k")>-1&&(M.b|=y.KSIDE_CASTLE),o[2].indexOf("q")>-1&&(M.b|=y.QSIDE_CASTLE),T="-"===o[3]?n:_[o[3]],x=parseInt(o[4],10),I=parseInt(o[5],10),U(D()),!0}function R(e){var r="No errors.",t="FEN string must contain six space-delimited fields.",n="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",u="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",l="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",d="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:t};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:n};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:s};var v=p[0].split("/");if(8!==v.length)return{valid:!1,error_number:7,error:u};for(var h=0;h<v.length;h++){for(var g=0,m=!1,b=0;b<v[h].length;b++)if(isNaN(v[h][b])){if(!/^[prnbqkPRNBQK]$/.test(v[h][b]))return{valid:!1,error_number:9,error:l};g+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c};g+=parseInt(v[h][b],10),m=!0}if(8!==g)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:d}:{valid:!0,error_number:0,error:r}}function D(){for(var e=0,o="",i=_.a8;i<=_.h1;i++){if(null==C[i])e++;else{e>0&&(o+=e,e=0);var a=C[i].color,s=C[i].type;o+=a===t?s.toUpperCase():s.toLowerCase()}i+1&136&&(e>0&&(o+=e),i!==_.h1&&(o+="/"),e=0,i+=8)}var u="";M[t]&y.KSIDE_CASTLE&&(u+="K"),M[t]&y.QSIDE_CASTLE&&(u+="Q"),M[r]&y.KSIDE_CASTLE&&(u+="k"),M[r]&y.QSIDE_CASTLE&&(u+="q"),u=u||"-";var c=T===n?"-":ae(T);return[o,O,u,c,x,I].join(" ")}function K(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(q[e[r]]=e[r+1]);return q}function U(e){j.length>0||(e!==f?(q.SetUp="1",q.FEN=e):(delete q.SetUp,delete q.FEN))}function B(e){var r=C[_[e]];return r?{type:r.type,color:r.color}:null}function Q(e,r){if(!("type"in e&&"color"in e))return!1;if(-1===l.indexOf(e.type.toLowerCase()))return!1;if(!(r in _))return!1;var t=_[r];return(e.type!=c||A[e.color]==n||A[e.color]==t)&&(C[t]={type:e.type,color:e.color},e.type===c&&(A[e.color]=t),U(D()),!0)}function W(e,r,t,n,i){var a={color:O,from:r,to:t,flags:n,piece:e[r].type};return i&&(a.flags|=y.PROMOTION,a.promotion=i),e[t]?a.captured=e[t].type:n&y.EP_CAPTURE&&(a.captured=o),a}function $(e){function r(e,r,t,n,c){if(e[t].type!==o||oe(n)!==E&&oe(n)!==w)r.push(W(e,t,n,c));else for(var l=[u,s,a,i],f=0,d=l.length;f<d;f++)r.push(W(e,t,n,c,l[f]))}var t=[],n=O,c=se(n),l={b:P,w:k},f=_.a8,d=_.h1,h=!1,g=!(void 0!==e&&"legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in _))return[];f=d=_[e.square],h=!0}for(var m=f;m<=d;m++)if(136&m)m+=7;else{var b=C[m];if(null!=b&&b.color===n)if(b.type===o){var S=m+p[n][0];if(null==C[S]){r(C,t,m,S,y.NORMAL);S=m+p[n][1];l[n]===oe(m)&&null==C[S]&&r(C,t,m,S,y.BIG_PAWN)}for(x=2;x<4;x++){136&(S=m+p[n][x])||(null!=C[S]&&C[S].color===c?r(C,t,m,S,y.CAPTURE):S===T&&r(C,t,m,T,y.EP_CAPTURE))}}else for(var x=0,I=v[b.type].length;x<I;x++){var j=v[b.type][x];for(S=m;!(136&(S+=j));){if(null!=C[S]){if(C[S].color===n)break;r(C,t,m,S,y.CAPTURE);break}if(r(C,t,m,S,y.NORMAL),"n"===b.type||"k"===b.type)break}}}if(!h||d===A[n]){if(M[n]&y.KSIDE_CASTLE){var q=(L=A[n])+2;null!=C[L+1]||null!=C[q]||V(c,A[n])||V(c,L+1)||V(c,q)||r(C,t,A[n],q,y.KSIDE_CASTLE)}if(M[n]&y.QSIDE_CASTLE){var L;q=(L=A[n])-2;null!=C[L-1]||null!=C[L-2]||null!=C[L-3]||V(c,A[n])||V(c,L-1)||V(c,q)||r(C,t,A[n],q,y.QSIDE_CASTLE)}}if(!g)return t;var F=[];for(m=0,I=t.length;m<I;m++)re(t[m]),X(n)||F.push(t[m]),te();return F}function G(e,r){var t="";if(e.flags&y.KSIDE_CASTLE)t="O-O";else if(e.flags&y.QSIDE_CASTLE)t="O-O-O";else{var n=function(e,r){for(var t=$({legal:!r}),n=e.from,o=e.to,i=e.piece,a=0,s=0,u=0,c=0,l=t.length;c<l;c++){var f=t[c].from,d=t[c].to,p=t[c].piece;i===p&&n!==f&&o===d&&(a++,oe(n)===oe(f)&&s++,ie(n)===ie(f)&&u++)}if(a>0)return s>0&&u>0?ae(n):u>0?ae(n).charAt(1):ae(n).charAt(0);return""}(e,r);e.piece!==o&&(t+=e.piece.toUpperCase()+n),e.flags&(y.CAPTURE|y.EP_CAPTURE)&&(e.piece===o&&(t+=ae(e.from)[0]),t+="x"),t+=ae(e.to),e.flags&y.PROMOTION&&(t+="="+e.promotion.toUpperCase())}return re(e),z()&&(Z()?t+="#":t+="+"),te(),t}function H(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function V(e,n){for(var i=_.a8;i<=_.h1;i++)if(136&i)i+=7;else if(null!=C[i]&&C[i].color===e){var a=C[i],s=i-n,u=s+119;if(h[u]&1<<m[a.type]){if(a.type===o){if(s>0){if(a.color===t)return!0}else if(a.color===r)return!0;continue}if("n"===a.type||"k"===a.type)return!0;for(var c=g[u],l=i+c,f=!1;l!==n;){if(null!=C[l]){f=!0;break}l+=c}if(!f)return!0}}return!1}function X(e){return V(se(e),A[e])}function z(){return X(O)}function Z(){return z()&&0===$().length}function Y(){return!z()&&0===$().length}function J(){for(var e={},r=[],t=0,n=0,o=_.a8;o<=_.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var s=C[o];s&&(e[s.type]=s.type in e?e[s.type]+1:1,s.type===a&&r.push(n),t++)}if(2===t)return!0;if(3===t&&(1===e[a]||1===e[i]))return!0;if(t===e[a]+2){var u=0,c=r.length;for(o=0;o<c;o++)u+=r[o];if(0===u||u===c)return!0}return!1}function ee(){for(var e=[],r={},t=!1;;){var n=te();if(!n)break;e.push(n)}for(;;){var o=D().split(" ").slice(0,4).join(" ");if(r[o]=o in r?r[o]+1:1,r[o]>=3&&(t=!0),!e.length)break;re(e.pop())}return t}function re(e){var t=O,i=se(t);if(function(e){j.push({move:e,kings:{b:A.b,w:A.w},turn:O,castling:{b:M.b,w:M.w},ep_square:T,half_moves:x,move_number:I})}(e),C[e.to]=C[e.from],C[e.from]=null,e.flags&y.EP_CAPTURE&&(O===r?C[e.to-16]=null:C[e.to+16]=null),e.flags&y.PROMOTION&&(C[e.to]={type:e.promotion,color:t}),C[e.to].type===c){if(A[C[e.to].color]=e.to,e.flags&y.KSIDE_CASTLE){var a=e.to-1,s=e.to+1;C[a]=C[s],C[s]=null}else if(e.flags&y.QSIDE_CASTLE){a=e.to+1,s=e.to-2;C[a]=C[s],C[s]=null}M[t]=""}if(M[t])for(var u=0,l=S[t].length;u<l;u++)if(e.from===S[t][u].square&&M[t]&S[t][u].flag){M[t]^=S[t][u].flag;break}if(M[i])for(u=0,l=S[i].length;u<l;u++)if(e.to===S[i][u].square&&M[i]&S[i][u].flag){M[i]^=S[i][u].flag;break}T=e.flags&y.BIG_PAWN?"b"===O?e.to-16:e.to+16:n,e.piece===o?x=0:e.flags&(y.CAPTURE|y.EP_CAPTURE)?x=0:x++,O===r&&I++,O=se(O)}function te(){var e=j.pop();if(null==e)return null;var t=e.move;A=e.kings,O=e.turn,M=e.castling,T=e.ep_square,x=e.half_moves,I=e.move_number;var n,i,a=O,s=se(O);if(C[t.from]=C[t.to],C[t.from].type=t.piece,C[t.to]=null,t.flags&y.CAPTURE)C[t.to]={type:t.captured,color:s};else if(t.flags&y.EP_CAPTURE){var u;u=a===r?t.to-16:t.to+16,C[u]={type:o,color:s}}t.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)&&(t.flags&y.KSIDE_CASTLE?(n=t.to+1,i=t.to-1):t.flags&y.QSIDE_CASTLE&&(n=t.to-2,i=t.to+1),C[n]=C[i],C[i]=null);return t}function ne(e,r){var t=H(e);if(r){var n=t.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(n)var o=n[1],i=n[2],a=n[3],s=n[4]}for(var u=$(),c=0,l=u.length;c<l;c++){if(t===H(G(u[c]))||r&&t===H(G(u[c],!0)))return u[c];if(n&&(!o||o.toLowerCase()==u[c].piece)&&_[i]==u[c].from&&_[a]==u[c].to&&(!s||s.toLowerCase()==u[c].promotion))return u[c]}return null}function oe(e){return e>>4}function ie(e){return 15&e}function ae(e){var r=ie(e),t=oe(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(t,t+1)}function se(e){return e===t?r:t}function ue(e){var r=function e(r){var t=r instanceof Array?[]:{};for(var n in r)t[n]="object"==typeof n?e(r[n]):r[n];return t}(e);r.san=G(r,!1),r.to=ae(r.to),r.from=ae(r.from);var t="";for(var n in y)y[n]&r.flags&&(t+=b[n]);return r.flags=t,r}function ce(e){return e.replace(/^\s+|\s+$/g,"")}return N(void 0===e?f:e),{WHITE:t,BLACK:r,PAWN:o,KNIGHT:i,BISHOP:a,ROOK:s,QUEEN:u,KING:c,SQUARES:function(){for(var e=[],r=_.a8;r<=_.h1;r++)136&r?r+=7:e.push(ae(r));return e}(),FLAGS:b,load:function(e){return N(e)},reset:function(){return F()},moves:function(e){for(var r=$(e),t=[],n=0,o=r.length;n<o;n++)void 0!==e&&"verbose"in e&&e.verbose?t.push(ue(r[n])):t.push(G(r[n],!1));return t},in_check:function(){return z()},in_checkmate:function(){return Z()},in_stalemate:function(){return Y()},in_draw:function(){return x>=100||Y()||J()||ee()},insufficient_material:function(){return J()},in_threefold_repetition:function(){return ee()},game_over:function(){return x>=100||Z()||Y()||J()||ee()},validate_fen:function(e){return R(e)},fen:function(){return D()},pgn:function(e){var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",t="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,n=[],o=!1;for(var i in q)n.push("["+i+' "'+q[i]+'"]'+r),o=!0;o&&j.length&&n.push(r);for(var a=[];j.length>0;)a.push(te());for(var s=[],u="";a.length>0;){var c=a.pop();j.length||"b"!==c.color?"w"===c.color&&(u.length&&s.push(u),u=I+"."):u=I+". ...",u=u+" "+G(c,!1),re(c)}if(u.length&&s.push(u),void 0!==q.Result&&s.push(q.Result),0===t)return n.join("")+s.join(" ");var l=0;for(i=0;i<s.length;i++)l+s[i].length>t&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(r),l=0):0!==i&&(n.push(" "),l++),n.push(s[i]),l+=s[i].length;return n.join("")},load_pgn:function(e,r){var t=void 0!==r&&"sloppy"in r&&r.sloppy;function n(e){return e.replace(/\\/g,"\\")}var o="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",i=new RegExp("^(\\[(.|"+n(o)+")*\\])("+n(o)+")*1.("+n(o)+"|.)*$","g"),a=e.replace(i,"$1");"["!==a[0]&&(a=""),F();var s=function(e,r){for(var t="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",o={},i=e.split(new RegExp(n(t))),a="",s="",u=0;u<i.length;u++)a=i[u].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[u].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ce(a).length>0&&(o[a]=s);return o}(a,r);for(var u in s)K([u,s[u]]);if("1"===s.SetUp&&!("FEN"in s&&N(s.FEN)))return!1;var c=e.replace(a,"").replace(new RegExp(n(o),"g")," ");c=c.replace(/(\{[^}]+\})+?/g,"");for(var l=/(\([^\(\)]+\))+?/g;l.test(c);)c=c.replace(l,"");var f=ce(c=(c=(c=c.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");for(var p="",v=0;v<f.length-1;v++){if(null==(p=ne(f[v],t)))return!1;re(p)}if(p=f[f.length-1],d.indexOf(p)>-1)(function(e){for(var r in e)return!0;return!1})(q)&&void 0===q.Result&&K(["Result",p]);else{if(null==(p=ne(p,t)))return!1;re(p)}return!0},header:function(){return K(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",r=_.a8;r<=_.h1;r++){if(0===ie(r)&&(e+=" "+"87654321"[oe(r)]+" |"),null==C[r])e+=" . ";else{var n=C[r].type;e+=" "+(C[r].color===t?n.toUpperCase():n.toLowerCase())+" "}r+1&136&&(e+="|\n",r+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return O},move:function(e,r){var t=void 0!==r&&"sloppy"in r&&r.sloppy,n=null;if("string"==typeof e)n=ne(e,t);else if("object"==typeof e)for(var o=$(),i=0,a=o.length;i<a;i++)if(!(e.from!==ae(o[i].from)||e.to!==ae(o[i].to)||"promotion"in o[i]&&e.promotion!==o[i].promotion)){n=o[i];break}if(!n)return null;var s=ue(n);return re(n),s},undo:function(){var e=te();return e?ue(e):null},clear:function(){return L()},put:function(e,r){return Q(e,r)},get:function(e){return B(e)},remove:function(e){return function(e){var r=B(e);return C[_[e]]=null,r&&r.type===c&&(A[r.color]=n),U(D()),r}(e)},perft:function(e){return function e(r){for(var t=$({legal:!1}),n=0,o=O,i=0,a=t.length;i<a;i++){if(re(t[i]),!X(o))if(r-1>0)n+=e(r-1);else n++;te()}return n}(e)},square_color:function(e){if(e in _){var r=_[e];return(oe(r)+ie(r))%2==0?"light":"dark"}return null},history:function(e){for(var r=[],t=[],n=(void 0!==e&&"verbose"in e&&e.verbose);j.length>0;)r.push(te());for(;r.length>0;){var o=r.pop();n?t.push(ue(o)):t.push(G(o)),re(o)}return t}}};void 0!==t&&(t.Chess=n)},{}],2:[function(e,r,t){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=e("./util");function i(e,r){var t=e(r);return r.dom.redraw(),t}function a(e,r){return{key:e,pos:o.key2pos(e),piece:r}}t.anim=function(e,r){return r.animation.enabled?function(e,r){var t=n({},r.pieces),i=e(r),c=function(e,r){var t,n,i,s,u={},c=[],l={},f=[],d=[],p={};for(i in e)p[i]=a(i,e[i]);for(var v=0,h=o.allKeys;v<h.length;v++){var g=h[v];t=r.pieces[g],n=p[g],t?n?o.samePiece(t,n.piece)||(f.push(n),d.push(a(g,t))):d.push(a(g,t)):n&&f.push(n)}return d.forEach((function(e){var r,t;r=e,t=f.filter((function(r){return o.samePiece(e.piece,r.piece)})),(n=t.sort((function(e,t){return o.distanceSq(r.pos,e.pos)-o.distanceSq(r.pos,t.pos)}))[0])&&(s=[n.pos[0]-e.pos[0],n.pos[1]-e.pos[1]],u[e.key]=s.concat(s),c.push(n.key))})),f.forEach((function(e){o.containsX(c,e.key)||(l[e.key]=e.piece)})),{anims:u,fadings:l}}(t,r);if(u(c.anims)&&u(c.fadings))r.dom.redraw();else{var l=r.animation.current&&r.animation.current.start;r.animation.current={start:s.now(),frequency:1/r.animation.duration,plan:c},l||function e(r,t){var n=r.animation.current;if(void 0===n)return void(r.dom.destroyed||r.dom.redrawNow());var i=1-(t-n.start)*n.frequency;if(i<=0)r.animation.current=void 0,r.dom.redrawNow();else{var a=(l=i)<.5?4*l*l*l:(l-1)*(2*l-2)*(2*l-2)+1;for(var u in n.plan.anims){var c=n.plan.anims[u];c[2]=c[0]*a,c[3]=c[1]*a}r.dom.redrawNow(!0),o.raf((function(t){return void 0===t&&(t=s.now()),e(r,t)}))}var l}(r,s.now())}return i}(e,r):i(e,r)},t.render=i;var s=void 0!==window.performance?window.performance:Date;function u(e){for(var r in e)return!1;return!0}},{"./util":17}],3:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./board"),o=e("./fen"),i=e("./config"),a=e("./anim"),s=e("./drag"),u=e("./explosion");t.start=function(e,r){function t(){n.toggleOrientation(e),r()}return{set:function(r){r.orientation&&r.orientation!==e.orientation&&t(),(r.fen?a.anim:a.render)((function(e){return i.configure(e,r)}),e)},state:e,getFen:function(){return o.write(e.pieces)},toggleOrientation:t,setPieces:function(r){a.anim((function(e){return n.setPieces(e,r)}),e)},selectSquare:function(r,t){r?a.anim((function(e){return n.selectSquare(e,r,t)}),e):e.selected&&(n.unselect(e),e.dom.redraw())},move:function(r,t){a.anim((function(e){return n.baseMove(e,r,t)}),e)},newPiece:function(r,t){a.anim((function(e){return n.baseNewPiece(e,r,t)}),e)},playPremove:function(){if(e.premovable.current){if(a.anim(n.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop:function(r){if(e.predroppable.current){var t=n.playPredrop(e,r);return e.dom.redraw(),t}return!1},cancelPremove:function(){a.render(n.unsetPremove,e)},cancelPredrop:function(){a.render(n.unsetPredrop,e)},cancelMove:function(){a.render((function(e){n.cancelMove(e),s.cancel(e)}),e)},stop:function(){a.render((function(e){n.stop(e),s.cancel(e)}),e)},explode:function(r){u.default(e,r)},setAutoShapes:function(r){a.render((function(e){return e.drawable.autoShapes=r}),e)},setShapes:function(r){a.render((function(e){return e.drawable.shapes=r}),e)},getKeyAtDomPos:function(r){return n.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds())},redrawAll:r,dragNewPiece:function(r,t,n){s.dragNewPiece(e,r,t,n)},destroy:function(){n.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":2,"./board":4,"./config":6,"./drag":7,"./explosion":10,"./fen":11}],4:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./util"),o=e("./premove");function i(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];e&&setTimeout((function(){return e.apply(void 0,r)}),1)}function a(e){e.premovable.current&&(e.premovable.current=void 0,i(e.premovable.events.unset))}function s(e){var r=e.predroppable;r.current&&(r.current=void 0,i(r.events.unset))}function u(e,r,t){var o=e.pieces[r],a=e.pieces[t];if(r===t||!o)return!1;var s=a&&a.color!==o.color?a:void 0;return t==e.selected&&p(e),i(e.events.move,r,t,s),function(e,r,t){if(!e.autoCastle)return!1;var o=e.pieces[r];if(!o||"king"!==o.role)return!1;var i=n.key2pos(r);if(5!==i[0])return!1;if(1!==i[1]&&8!==i[1])return!1;var a,s,u,c=n.key2pos(t);if(7===c[0]||8===c[0])a=n.pos2key([8,i[1]]),s=n.pos2key([6,i[1]]),u=n.pos2key([7,i[1]]);else{if(3!==c[0]&&1!==c[0])return!1;a=n.pos2key([1,i[1]]),s=n.pos2key([4,i[1]]),u=n.pos2key([3,i[1]])}var l=e.pieces[a];return!(!l||"rook"!==l.role)&&(delete e.pieces[r],delete e.pieces[a],e.pieces[u]=o,e.pieces[s]=l,!0)}(e,r,t)||(e.pieces[t]=o,delete e.pieces[r]),e.lastMove=[r,t],e.check=void 0,i(e.events.change),s||!0}function c(e,r,t,o){if(e.pieces[t]){if(!o)return!1;delete e.pieces[t]}return i(e.events.dropNewPiece,r,t),e.pieces[t]=r,e.lastMove=[t],e.check=void 0,i(e.events.change),e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),!0}function l(e,r,t){var o=u(e,r,t);return o&&(e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),e.animation.current=void 0),o}function f(e,r,t){if(h(e,r,t)){var a=l(e,r,t);if(a){var u=e.hold.stop();p(e);var c={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:u};return!0!==a&&(c.captured=a),i(e.movable.events.after,r,t,c),!0}}else!function(e,r,t){return r!==t&&g(e,r)&&n.containsX(o.default(e.pieces,r,e.premovable.castle),t)}(e,r,t)?v(e,t)||g(e,t)?(d(e,t),e.hold.start()):p(e):(!function(e,r,t,n){s(e),e.premovable.current=[r,t],i(e.premovable.events.set,r,t,n)}(e,r,t,{ctrlKey:e.stats.ctrlKey}),p(e));return!1}function d(e,r){e.selected=r,g(e,r)?e.premovable.dests=o.default(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function p(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function v(e,r){var t=e.pieces[r];return!!t&&("both"===e.movable.color||e.movable.color===t.color&&e.turnColor===t.color)}function h(e,r,t){return r!==t&&v(e,r)&&(e.movable.free||!!e.movable.dests&&n.containsX(e.movable.dests[r],t))}function g(e,r){var t=e.pieces[r];return!!t&&e.premovable.enabled&&e.movable.color===t.color&&e.turnColor!==t.color}function m(e){a(e),s(e),p(e)}t.callUserFunction=i,t.toggleOrientation=function(e){e.orientation=n.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},t.reset=function(e){e.lastMove=void 0,p(e),a(e),s(e)},t.setPieces=function(e,r){for(var t in r){var n=r[t];n?e.pieces[t]=n:delete e.pieces[t]}},t.setCheck=function(e,r){if(!0===r&&(r=e.turnColor),r)for(var t in e.pieces)"king"===e.pieces[t].role&&e.pieces[t].color===r&&(e.check=t);else e.check=void 0},t.unsetPremove=a,t.unsetPredrop=s,t.baseMove=u,t.baseNewPiece=c,t.userMove=f,t.dropNewPiece=function(e,r,t,n){if(function(e,r,t){var n=e.pieces[r];return!!n&&t&&(r===t||!e.pieces[t])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,r,t)||n){var o=e.pieces[r];delete e.pieces[r],c(e,o,t,n),i(e.movable.events.afterNewPiece,o.role,t,{predrop:!1})}else!function(e,r,t){var n=e.pieces[r],o=e.pieces[t];return!!n&&t&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==t[1]&&"8"!==t[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,r,t)?(a(e),s(e)):function(e,r,t){a(e),e.predroppable.current={role:r,key:t},i(e.predroppable.events.set,r,t)}(e,e.pieces[r].role,t);delete e.pieces[r],p(e)},t.selectSquare=function(e,r,t){e.selected?e.selected!==r||e.draggable.enabled?(e.selectable.enabled||t)&&e.selected!==r?f(e,e.selected,r)&&(e.stats.dragged=!1):e.hold.start():(p(e),e.hold.cancel()):(v(e,r)||g(e,r))&&(d(e,r),e.hold.start()),i(e.events.select,r)},t.setSelected=d,t.unselect=p,t.canMove=h,t.isDraggable=function(e,r){var t=e.pieces[r];return!!t&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===t.color&&(e.turnColor===t.color||e.premovable.enabled))},t.playPremove=function(e){var r=e.premovable.current;if(!r)return!1;var t=r[0],n=r[1],o=!1;if(h(e,t,n)){var s=l(e,t,n);if(s){var u={premove:!0};!0!==s&&(u.captured=s),i(e.movable.events.after,t,n,u),o=!0}}return a(e),o},t.playPredrop=function(e,r){var t=e.predroppable.current,n=!1;return!!t&&(r(t)&&c(e,{role:t.role,color:e.movable.color},t.key)&&(i(e.movable.events.afterNewPiece,t.role,t.key,{predrop:!0}),n=!0),s(e),n)},t.cancelMove=m,t.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,m(e)},t.getKeyAtDomPos=function(e,r,t){var o=Math.ceil((e[0]-t.left)/t.width*8);r||(o=9-o);var i=Math.ceil(8-(e[1]-t.top)/t.height*8);return r||(i=9-i),o>0&&o<9&&i>0&&i<9?n.pos2key([o,i]):void 0}},{"./premove":12,"./util":17}],5:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./api"),o=e("./config"),i=e("./state"),a=e("./wrap"),s=e("./events"),u=e("./render"),c=e("./svg"),l=e("./util");function f(e){var r=!1;return function(){r||(r=!0,l.raf((function(){e(),r=!1})))}}t.Chessground=function(e,r){var t=i.defaults();function d(){var r=t.dom&&t.dom.unbind;e.classList.add("cg-board-wrap");var n=l.memo((function(){return e.getBoundingClientRect()})),o=t.viewOnly&&!t.drawable.visible,i=a.default(e,t,o?void 0:n()),p=function(e){u.default(t),!e&&i.svg&&c.renderSvg(t,i.svg)};t.dom={elements:i,bounds:n,redraw:f(p),redrawNow:p,unbind:r,relative:o},t.drawable.prevSvgHash="",p(!1),s.bindBoard(t),r||(t.dom.unbind=s.bindDocument(t,d))}return o.configure(t,r||{}),d(),n.start(t,d)}},{"./api":3,"./config":6,"./events":9,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],6:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./board"),o=e("./fen");function i(e){return"object"==typeof e}t.configure=function(e,r){if(r.movable&&r.movable.dests&&(e.movable.dests=void 0),function e(r,t){for(var n in t)i(r[n])&&i(t[n])?e(r[n],t[n]):r[n]=t[n]}(e,r),r.fen&&(e.pieces=o.read(r.fen),e.drawable.shapes=[]),r.hasOwnProperty("check")&&n.setCheck(e,r.check||!1),r.hasOwnProperty("lastMove")&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&n.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var t="white"===e.movable.color?1:8,a="e"+t,s=e.movable.dests[a],u=e.pieces[a];if(!s||!u||"king"!==u.role)return;e.movable.dests[a]=s.filter((function(e){return!(e==="a"+t&&-1!==s.indexOf("c"+t)||e==="h"+t&&-1!==s.indexOf("g"+t))}))}}},{"./board":4,"./fen":11}],7:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./board"),o=e("./util"),i=e("./draw"),a=e("./anim");function s(e){o.raf((function(){var r=e.draggable.current;if(r){e.animation.current&&e.animation.current.plan.anims[r.orig]&&(e.animation.current=void 0);var t=e.pieces[r.orig];if(t&&o.samePiece(t,r.piece)){if(!r.started&&o.distanceSq(r.epos,r.rel)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if("function"==typeof r.element){var n=r.element();if(!n)return;r.element=n,r.element.cgDragging=!0,r.element.classList.add("dragging")}var i="white"===e.orientation,a=e.dom.bounds();r.pos=[r.epos[0]-r.rel[0],r.epos[1]-r.rel[1]];var c=o.posToTranslateAbs(a)(r.origPos,i);c[0]+=r.pos[0]+r.dec[0],c[1]+=r.pos[1]+r.dec[1],o.translateAbs(r.element,c)}}else u(e);s(e)}}))}function u(e){var r=e.draggable.current;r&&(r.newPiece&&delete e.pieces[r.orig],e.draggable.current=void 0,n.unselect(e),c(e),e.dom.redraw())}function c(e){var r=e.dom.elements;r.ghost&&o.setVisible(r.ghost,!1)}function l(e,r,t){var n=o.key2pos(e);return r||(n[0]=9-n[0],n[1]=9-n[1]),{left:t.left+t.width*(n[0]-1)/8,top:t.top+t.height*(8-n[1])/8,width:t.width/8,height:t.height/8}}function f(e,r){for(var t=e.dom.elements.board.firstChild;t;){if(t.cgKey===r&&"PIECE"===t.tagName)return t;t=t.nextSibling}}t.start=function(e,r){if(!(void 0!==r.button&&0!==r.button||r.touches&&r.touches.length>1)){r.preventDefault();var t="white"===e.orientation,u=e.dom.bounds(),c=o.eventPosition(r),d=n.getKeyAtDomPos(c,t,u);if(d){var p=e.pieces[d],v=e.selected;v||!e.drawable.enabled||!e.drawable.eraseOnClick&&p&&p.color===e.turnColor||i.clear(e);var h=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&n.canMove(e,e.selected,d)?a.anim((function(e){return n.selectSquare(e,d)}),e):n.selectSquare(e,d);var m=e.selected===d,b=f(e,d);if(p&&b&&m&&n.isDraggable(e,d)){var y=l(d,t,u);e.draggable.current={orig:d,origPos:o.key2pos(d),piece:p,rel:c,epos:c,pos:[0,0],dec:e.draggable.centerPiece?[c[0]-(y.left+y.width/2),c[1]-(y.top+y.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:v,originTarget:r.target},b.cgDragging=!0,b.classList.add("dragging");var w=e.dom.elements.ghost;w&&(w.className="ghost "+p.color+" "+p.role,o.translateAbs(w,o.posToTranslateAbs(u)(o.key2pos(d),t)),o.setVisible(w,!0)),s(e)}else h&&n.unsetPremove(e),g&&n.unsetPredrop(e);e.dom.redraw()}}},t.dragNewPiece=function(e,r,t,n){e.pieces.a0=r,e.dom.redraw();var i=o.eventPosition(t),a="white"===e.orientation,u=e.dom.bounds(),c=l("a0",a,u),d=[(a?0:7)*c.width+u.left,(a?8:-1)*c.height+u.top];e.draggable.current={orig:"a0",origPos:o.key2pos("a0"),piece:r,rel:d,epos:i,pos:[i[0]-d[0],i[1]-d[1]],dec:[-c.width/2,-c.height/2],started:!0,element:function(){return f(e,"a0")},originTarget:t.target,newPiece:!0,force:n||!1},s(e)},t.move=function(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.epos=o.eventPosition(r))},t.end=function(e,r){var t=e.draggable.current;if(t)if("touchend"!==r.type||!t||t.originTarget===r.target||t.newPiece){n.unsetPremove(e),n.unsetPredrop(e);var i=o.eventPosition(r)||t.epos,a=n.getKeyAtDomPos(i,"white"===e.orientation,e.dom.bounds());a&&t.started?t.newPiece?n.dropNewPiece(e,t.orig,a,t.force):(e.stats.ctrlKey=r.ctrlKey,n.userMove(e,t.orig,a)&&(e.stats.dragged=!0)):t.newPiece?delete e.pieces[t.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[t.orig],n.callUserFunction(e.events.change)),(!t||t.orig!==t.previouslySelected||t.orig!==a&&a)&&e.selectable.enabled||n.unselect(e),c(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},t.cancel=u},{"./anim":2,"./board":4,"./draw":8,"./util":17}],8:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./board"),o=e("./util"),i=["green","red","blue","yellow"];function a(e){o.raf((function(){var r=e.drawable.current;if(r){var t=n.getKeyAtDomPos(r.pos,"white"===e.orientation,e.dom.bounds());t!==r.mouseSq&&(r.mouseSq=t,r.dest=t!==r.orig?t:void 0,e.dom.redrawNow()),a(e)}}))}function s(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function u(e){var r=e.shiftKey&&o.isRightButton(e)?1:0,t=e.altKey?2:0;return i[r+t]}function c(e){e.onChange&&e.onChange(e.shapes)}t.start=function(e,r){if(!(r.touches&&r.touches.length>1)){r.stopPropagation(),r.preventDefault(),r.ctrlKey?n.unselect(e):n.cancelMove(e);var t=o.eventPosition(r),i=n.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds());i&&(e.drawable.current={orig:i,pos:t,brush:u(r)},a(e))}},t.processDraw=a,t.move=function(e,r){e.drawable.current&&(e.drawable.current.pos=o.eventPosition(r))},t.end=function(e){var r=e.drawable.current;r&&(r.mouseSq&&function(e,r){var t=function(e){return e.orig===r.orig&&e.dest===r.dest},n=e.shapes.filter(t)[0];n&&(e.shapes=e.shapes.filter((o=t,function(e){return!o(e)})));var o;n&&n.brush===r.brush||e.shapes.push(r);c(e)}(e.drawable,r),s(e))},t.cancel=s,t.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),c(e.drawable))}},{"./board":4,"./util":17}],9:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./drag"),o=e("./draw"),i=e("./util");function a(e,r,t,n){return e.addEventListener(r,t,n),function(){return e.removeEventListener(r,t)}}function s(e,r,t){return function(n){n.shiftKey||i.isRightButton(n)?e.drawable.enabled&&t(e,n):e.viewOnly||r(e,n)}}t.bindBoard=function(e){if(!e.viewOnly){var r=e.dom.elements.board,t=function(e){return function(r){e.draggable.current?n.cancel(e):e.drawable.current?o.cancel(e):r.shiftKey||i.isRightButton(r)?e.drawable.enabled&&o.start(e,r):e.viewOnly||n.start(e,r)}}(e);r.addEventListener("touchstart",t),r.addEventListener("mousedown",t),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",(function(e){return e.preventDefault()}))}},t.bindDocument=function(e,r){var t=[];if(!e.dom.relative&&e.resizable){t.push(a(document.body,"chessground.resize",(function(){e.dom.bounds.clear(),i.raf(r)})))}if(!e.viewOnly){var u=s(e,n.move,o.move),c=s(e,n.end,o.end);["touchmove","mousemove"].forEach((function(e){return t.push(a(document,e,u))})),["touchend","mouseup"].forEach((function(e){return t.push(a(document,e,c))}));var l=function(){return e.dom.bounds.clear()};t.push(a(window,"scroll",l,{passive:!0})),t.push(a(window,"resize",l,{passive:!0}))}return function(){return t.forEach((function(e){return e()}))}}},{"./drag":7,"./draw":8,"./util":17}],10:[function(e,r,t){"use strict";function n(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout((function(){n(e,2),setTimeout((function(){return n(e,void 0)}),120)}),120)}},{}],11:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./util"),o=e("./types");t.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.read=function(e){"start"===e&&(e=t.initial);for(var r={},o=8,a=0,s=0,u=e;s<u.length;s++){var c=u[s];switch(c){case" ":return r;case"/":if(0===--o)return r;a=0;break;case"~":var l=r[n.pos2key([a,o])];l&&(l.promoted=!0);break;default:var f=c.charCodeAt(0);if(f<57)a+=f-48;else{++a;var d=c.toLowerCase();r[n.pos2key([a,o])]={role:i[d],color:c===d?"black":"white"}}}}return r},t.write=function(e){return n.invRanks.map((function(r){return o.ranks.map((function(t){var o=e[n.pos2key([t,r])];if(o){var i=a[o.role];return"white"===o.color?i.toUpperCase():i}return"1"})).join("")})).join("/").replace(/1{2,}/g,(function(e){return e.length.toString()}))}},{"./types":16,"./util":17}],12:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./util");function o(e,r){return Math.abs(e-r)}var i=function(e,r,t,n){var i=o(e,t),a=o(r,n);return 1===i&&2===a||2===i&&1===a},a=function(e,r,t,n){return o(e,t)===o(r,n)},s=function(e,r,t,n){return e===t||r===n},u=function(e,r,t,n){return a(e,r,t,n)||s(e,r,t,n)};t.default=function(e,r,t){var c,l,f=e[r],d=n.key2pos(r);switch(f.role){case"pawn":l=f.color,c=function(e,r,t,n){return o(e,t)<2&&("white"===l?n===r+1||r<=2&&n===r+2&&e===t:n===r-1||r>=7&&n===r-2&&e===t)};break;case"knight":c=i;break;case"bishop":c=a;break;case"rook":c=s;break;case"queen":c=u;break;case"king":c=function(e,r,t){return function(i,a,s,u){return o(i,s)<2&&o(a,u)<2||t&&a===u&&a===("white"===e?1:8)&&(5===i&&(3===s||7===s)||n.containsX(r,s))}}(f.color,function(e,r){return Object.keys(e).filter((function(t){var n=e[t];return n&&n.color===r&&"rook"===n.role})).map((function(e){return n.key2pos(e)[0]}))}(e,f.color),t)}return n.allKeys.map(n.key2pos).filter((function(e){return(d[0]!==e[0]||d[1]!==e[1])&&c(d[0],d[1],e[0],e[1])})).map(n.pos2key)}},{"./util":17}],13:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./util"),o=e("./util");function i(e){return"PIECE"===e.tagName}function a(e){return"SQUARE"===e.tagName}function s(e,r){for(var t in r)e.dom.elements.board.removeChild(r[t])}function u(e,r){var t=2+8*(e[1]-1)+(8-e[0]);return r&&(t=67-t),t+""}function c(e){return e.color+" "+e.role}function l(e,r,t){e[r]?e[r]+=" "+t:e[r]=t}t.default=function(e){var r,t,f,d,p,v,h,g,m,b,y,w="white"===e.orientation,k=e.dom.relative?o.posToTranslateRel:o.posToTranslateAbs(e.dom.bounds()),P=e.dom.relative?o.translateRel:o.translateAbs,E=e.dom.elements.board,_=e.pieces,S=e.animation.current,C=S?S.plan.anims:{},A=S?S.plan.fadings:{},O=e.draggable.current,M=function(e){var r,t,n={};if(e.lastMove&&e.highlight.lastMove)for(r in e.lastMove)l(n,e.lastMove[r],"last-move");e.check&&e.highlight.check&&l(n,e.check,"check");if(e.selected&&(l(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(r in o)t=o[r],l(n,t,"move-dest"+(e.pieces[t]?" oc":""));var i=e.premovable.dests;if(i)for(r in i)t=i[r],l(n,t,"premove-dest"+(e.pieces[t]?" oc":""))}var a=e.premovable.current;if(a)for(r in a)l(n,a[r],"current-premove");else e.predroppable.current&&l(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(r in s.keys)l(n,s.keys[r],"exploding"+s.stage);return n}(e),T={},x={},I={},j={},q=Object.keys(_);for(f=E.firstChild;f;){if(r=f.cgKey,i(f))if(d=_[r],v=C[r],h=A[r],p=f.cgPiece,!f.cgDragging||O&&O.orig===r||(f.classList.remove("dragging"),P(f,k(n.key2pos(r),w)),f.cgDragging=!1),!h&&f.cgFading&&(f.cgFading=!1,f.classList.remove("fading")),d){if(v&&f.cgAnimating&&p===c(d))(K=n.key2pos(r))[0]+=v[2],K[1]+=v[3],f.classList.add("anim"),P(f,k(K,w));else f.cgAnimating&&(f.cgAnimating=!1,f.classList.remove("anim"),P(f,k(n.key2pos(r),w)),e.addPieceZIndex&&(f.style.zIndex=u(n.key2pos(r),w)));p!==c(d)||h&&f.cgFading?h&&p===c(h)?(f.classList.add("fading"),f.cgFading=!0):I[p]?I[p].push(f):I[p]=[f]:T[r]=!0}else I[p]?I[p].push(f):I[p]=[f];else if(a(f)){var L=f.className;M[r]===L?x[r]=!0:j[L]?j[L].push(f):j[L]=[f]}f=f.nextSibling}for(var F in M)if(!x[F]){y=(b=j[M[F]])&&b.pop();var N=k(n.key2pos(F),w);if(y)y.cgKey=F,P(y,N);else{var R=n.createEl("square",M[F]);R.cgKey=F,P(R,N),E.insertBefore(R,E.firstChild)}}for(var D in q)if(t=_[r=q[D]],v=C[r],!T[r])if(m=(g=I[c(t)])&&g.pop()){m.cgKey=r,m.cgFading&&(m.classList.remove("fading"),m.cgFading=!1);var K=n.key2pos(r);e.addPieceZIndex&&(m.style.zIndex=u(K,w)),v&&(m.cgAnimating=!0,m.classList.add("anim"),K[0]+=v[2],K[1]+=v[3]),P(m,k(K,w))}else{var U=c(t),B=n.createEl("piece",U);K=n.key2pos(r);B.cgPiece=U,B.cgKey=r,v&&(B.cgAnimating=!0,K[0]+=v[2],K[1]+=v[3]),P(B,k(K,w)),e.addPieceZIndex&&(B.style.zIndex=u(K,w)),E.appendChild(B)}for(var Q in I)s(e,I[Q]);for(var Q in j)s(e,j[Q])}},{"./util":17}],14:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./fen"),o=e("./util");t.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":11,"./util":17}],15:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=e("./util");function i(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function a(e,r,t){var n,o=e.orig,i=e.dest,a=e.brush,u=e.piece,c=e.modifiers;return[t,o,i,a,i&&r[i]>1,u&&s(u),c&&(n=c,""+(n.lineWidth||""))].filter((function(e){return e})).join("")}function s(e){return[e.color,e.role,e.scale].filter((function(e){return e})).join("")}function u(e){var r=c(i("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(c(i("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function c(e,r){for(var t in r)e.setAttribute(t,r[t]);return e}function l(e,r){return"white"===r?e:[9-e[0],9-e[1]]}function f(e,r){var t={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth)};return t.key=[e.key,r.lineWidth].filter((function(e){return e})).join(""),t}function d(e,r,t){return(e.lineWidth||10)*(r?.85:1)/512*t.width}function p(e,r){return(e.opacity||1)*(r?.9:1)}function v(e,r){return[(e[0]-.5)*r.width/8,(8.5-e[1])*r.height/8]}t.createElement=i,t.renderSvg=function(e,r){var t=e.drawable,s=t.current,h=s&&s.mouseSq?s:void 0,g={};t.shapes.concat(t.autoShapes).concat(h?[h]:[]).forEach((function(e){e.dest&&(g[e.dest]=(g[e.dest]||0)+1)}));var m=t.shapes.concat(t.autoShapes).map((function(e){return{shape:e,current:!1,hash:a(e,g,!1)}}));h&&m.push({shape:h,current:!0,hash:a(h,g,!0)});var b=m.map((function(e){return e.hash})).join("");if(b!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=b;var y=r.firstChild;!function(e,r,t){var n,o={};r.forEach((function(r){r.shape.dest&&(n=e.brushes[r.shape.brush],r.shape.modifiers&&(n=f(n,r.shape.modifiers)),o[n.key]=n)}));var i={},a=t.firstChild;for(;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||t.appendChild(u(o[s]))}(t,m,y),function(e,r,t,a,s,u){void 0===n&&(n=o.computeIsTrident());var h=e.dom.bounds(),g={},m=[];r.forEach((function(e){g[e.hash]=!1}));var b,y=u.nextSibling;for(;y;)b=y.getAttribute("cgHash"),g.hasOwnProperty(b)?g[b]=!0:m.push(y),y=y.nextSibling;m.forEach((function(e){return s.removeChild(e)})),r.forEach((function(r){g[r.hash]||s.appendChild(function(e,r,t,a,s){var u,h=r.shape,g=r.current,m=r.hash;if(h.piece)u=function(e,r,t,n){var o=v(r,n),a=n.width/8*(t.scale||1),s=t.color[0]+("knight"===t.role?"n":t.role[0]).toUpperCase();return c(i("image"),{className:t.role+" "+t.color,x:o[0]-a/2,y:o[1]-a/2,width:a,height:a,href:e+s+".svg"})}(e.drawable.pieces.baseUrl,l(o.key2pos(h.orig),e.orientation),h.piece,s);else{var b=l(o.key2pos(h.orig),e.orientation);if(h.orig&&h.dest){var y=t[h.brush];h.modifiers&&(y=f(y,h.modifiers)),u=function(e,r,t,o,a,s){var u=function(e,r){return n?0:(r?20:10)/512*e.width}(s,a&&!o),l=v(r,s),f=v(t,s),h=f[0]-l[0],g=f[1]-l[1],m=Math.atan2(g,h),b=Math.cos(m)*u,y=Math.sin(m)*u;return c(i("line"),{stroke:e.color,"stroke-width":d(e,o,s),"stroke-linecap":"round","marker-end":n?void 0:"url(#arrowhead-"+e.key+")",opacity:p(e,o),x1:l[0],y1:l[1],x2:f[0]-b,y2:f[1]-y})}(y,b,l(o.key2pos(h.dest),e.orientation),g,a[h.dest]>1,s)}else u=function(e,r,t,n){var o=v(r,n),a=function(e){var r=e.width/512;return[3*r,4*r]}(n),s=(n.width+n.height)/32;return c(i("circle"),{stroke:e.color,"stroke-width":a[t?0:1],fill:"none",opacity:p(e,t),cx:o[0],cy:o[1],r:s-a[1]/2})}(t[h.brush],b,g,s)}return u.setAttribute("cgHash",m),u}(e,r,t,a,h))}))}(e,m,t.brushes,g,r,y)}}},{"./util":17}],16:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.files=["a","b","c","d","e","f","g","h"],t.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,r,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});var o=e("./types");t.colors=["white","black"],t.invRanks=[8,7,6,5,4,3,2,1],t.allKeys=(n=Array.prototype).concat.apply(n,o.files.map((function(e){return o.ranks.map((function(r){return e+r}))}))),t.pos2key=function(e){return t.allKeys[8*e[0]+e[1]-9]},t.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},t.memo=function(e){var r,t=function(){return void 0===r&&(r=e()),r};return t.clear=function(){r=void 0},t},t.timer=function(){var e;return{start:function(){e=Date.now()},cancel:function(){e=void 0},stop:function(){if(!e)return 0;var r=Date.now()-e;return e=void 0,r}}},t.opposite=function(e){return"white"===e?"black":"white"},t.containsX=function(e,r){return void 0!==e&&-1!==e.indexOf(r)},t.distanceSq=function(e,r){return Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)},t.samePiece=function(e,r){return e.role===r.role&&e.color===r.color},t.computeIsTrident=function(){return window.navigator.userAgent.indexOf("Trident/")>-1};var i=function(e,r,t,n){return[(r?e[0]-1:8-e[0])*t,(r?8-e[1]:e[1]-1)*n]};t.posToTranslateAbs=function(e){var r=e.width/8,t=e.height/8;return function(e,n){return i(e,n,r,t)}},t.posToTranslateRel=function(e,r){return i(e,r,12.5,12.5)},t.translateAbs=function(e,r){e.style.transform="translate("+r[0]+"px,"+r[1]+"px)"},t.translateRel=function(e,r){e.style.left=r[0]+"%",e.style.top=r[1]+"%"},t.setVisible=function(e,r){e.style.visibility=r?"visible":"hidden"},t.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},t.isRightButton=function(e){return 2===e.buttons||2===e.button},t.createEl=function(e,r){var t=document.createElement(e);return r&&(t.className=r),t},t.raf=(window.requestAnimationFrame||window.setTimeout).bind(window)},{"./types":16}],18:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./util"),o=e("./types"),i=e("./svg");function a(e,r){var t,o=n.createEl("coords",r);for(var i in e)(t=n.createEl("coord")).textContent=e[i],o.appendChild(t);return o}t.default=function(e,r,t){e.innerHTML="",e.classList.add("cg-board-wrap"),n.colors.forEach((function(t){e.classList.toggle("orientation-"+t,r.orientation===t)})),e.classList.toggle("manipulable",!r.viewOnly);var s,u,c=n.createEl("div","cg-board");if(e.appendChild(c),r.drawable.visible&&t&&((s=i.createElement("svg")).appendChild(i.createElement("defs")),e.appendChild(s)),r.coordinates){var l="black"===r.orientation?" black":"";e.appendChild(a(o.ranks,"ranks"+l)),e.appendChild(a(o.files,"files"+l))}return t&&r.draggable.showGhost&&(u=n.createEl("piece","ghost"),n.setVisible(u,!1),e.appendChild(u)),{board:c,ghost:u,svg:s}}},{"./svg":15,"./types":16,"./util":17}],19:[function(e,r,t){var n,o,i=r.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(r){try{return n.call(null,e,0)}catch(r){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var c,l=[],f=!1,d=-1;function p(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&v())}function v(){if(!f){var e=u(p);f=!0;for(var r=l.length;r;){for(c=l,l=[];++d<r;)c&&c[d].run();d=-1,r=l.length}c=null,f=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(r){try{return o.call(null,e)}catch(r){return o.call(this,e)}}}(e)}}function h(e,r){this.fun=e,this.array=r}function g(){}i.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];l.push(new h(e,r)),1!==l.length||f||u(v)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],20:[function(e,r,t){(function(t){"use strict";"production"===t.env.NODE_ENV?r.exports=e("./search-params.cjs.production.min.js"):r.exports=e("./search-params.cjs.development.js")}).call(this,e("_process"))},{"./search-params.cjs.development.js":21,"./search-params.cjs.production.min.js":22,_process:19}],21:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},o=function(e){return encodeURIComponent(e)},i=function(e){return decodeURIComponent(e)},a=function(e,r,t){return null===r?function(e,r){return"hidden"===r.nullFormat?"":"string"===r.nullFormat?e+"=null":e}(e,t):"boolean"==typeof r?function(e,r,t){return"empty-true"===t.booleanFormat&&r?e:e+"="+("unicode"===t.booleanFormat?r?"✓":"✗":r.toString())}(e,r,t):Array.isArray(r)?function(e,r,t){var n=function(e){return"index"===e.arrayFormat?function(e,r){return e+"["+r+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}}(t);return r.map((function(r,t){return n(e,t)+"="+o(r)})).join("&")}(e,r,t):e+"="+o(r)},s=function(e){var r=e.indexOf("?");return-1===r?e:e.slice(r+1)},u=function(e){var r=e.indexOf("["),t=-1!==r;return{hasBrackets:t,name:t?e.slice(0,r):e}},c=function(e,r){var t=n(r);return s(e).split("&").reduce((function(e,r){var n=r.split("="),o=n[0],a=n[1],s=u(o),c=s.hasBrackets,l=s.name,f=e[l],d=function(e,r){if(void 0===e)return"empty-true"===r.booleanFormat||null;if("string"===r.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}if("unicode"===r.booleanFormat){if("✓"===i(e))return!0;if("✗"===i(e))return!1}return"string"===r.nullFormat&&"null"===e?null:i(e)}(a,t);return e[l]=void 0===f?c?[d]:d:(Array.isArray(f)?f:[f]).concat(d),e}),{})};t.build=function(e,r){var t=n(r);return Object.keys(e).filter((function(r){return void 0!==e[r]})).map((function(r){return a(r,e[r],t)})).filter(Boolean).join("&")},t.keep=function(e,r,t){var o=n(t);if(""===s(e))return{keptParams:{},querystring:""};var i=e.split("&").reduce((function(e,t){var n=t.split("=")[0],o=u(n).name;return r.includes(o)&&e.push(t),e}),[]);return{keptParams:c(i.join("&"),o),querystring:i.join("&")}},t.omit=function(e,r,t){var o=n(t);if(""===s(e))return{querystring:"",removedParams:{}};var i=e.split("&").reduce((function(e,t){var n=e[0],o=e[1],i=t.split("=")[0],a=u(i).name;return-1===r.indexOf(a)?[n.concat(t),o]:[n,o.concat(t)]}),[[],[]]),a=i[0],l=i[1];return{querystring:a.join("&"),removedParams:c(l.join("&"),o)}},t.parse=c},{}],22:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}},o=function(e){return encodeURIComponent(e)},i=function(e){return decodeURIComponent(e)},a=function(e){var r=e.indexOf("?");return-1===r?e:e.slice(r+1)},s=function(e){var r=e.indexOf("["),t=-1!==r;return{hasBrackets:t,name:t?e.slice(0,r):e}},u=function(e,r){var t=n(r);return a(e).split("&").reduce((function(e,r){var n=r.split("="),o=n[1],a=s(n[0]),u=a.hasBrackets,c=a.name,l=e[c],f=function(e,r){if(void 0===e)return"empty-true"===r.booleanFormat||null;if("string"===r.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}if("unicode"===r.booleanFormat){if("✓"===i(e))return!0;if("✗"===i(e))return!1}return"string"===r.nullFormat&&"null"===e?null:i(e)}(o,t);return e[c]=void 0===l?u?[f]:f:(Array.isArray(l)?l:[l]).concat(f),e}),{})};t.build=function(e,r){var t=n(r);return Object.keys(e).filter((function(r){return void 0!==e[r]})).map((function(r){return function(e,r,t){return null===r?function(e,r){return"hidden"===r.nullFormat?"":"string"===r.nullFormat?e+"=null":e}(e,t):"boolean"==typeof r?function(e,r,t){return"empty-true"===t.booleanFormat&&r?e:e+"="+("unicode"===t.booleanFormat?r?"✓":"✗":r.toString())}(e,r,t):Array.isArray(r)?function(e,r,t){var n=function(e){return"index"===e.arrayFormat?function(e,r){return e+"["+r+"]"}:"brackets"===e.arrayFormat?function(e){return e+"[]"}:function(e){return e}}(t);return r.map((function(r,t){return n(e,t)+"="+o(r)})).join("&")}(e,r,t):e+"="+o(r)}(r,e[r],t)})).filter(Boolean).join("&")},t.keep=function(e,r,t){var o=n(t);if(""===a(e))return{keptParams:{},querystring:""};var i=e.split("&").reduce((function(e,t){var n=t.split("=")[0],o=s(n).name;return r.includes(o)&&e.push(t),e}),[]);return{keptParams:u(i.join("&"),o),querystring:i.join("&")}},t.omit=function(e,r,t){var o=n(t);if(""===a(e))return{querystring:"",removedParams:{}};var i=e.split("&").reduce((function(e,t){var n=e[0],o=e[1],i=t.split("=")[0],a=s(i).name;return-1===r.indexOf(a)?[n.concat(t),o]:[n,o.concat(t)]}),[[],[]]),c=i[1];return{querystring:i[0].join("&"),removedParams:u(c.join("&"),o)}},t.parse=u},{}],23:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("./stockfishqueue"),o=e("./generator"),i=e("./shapes"),a=e("./util"),s=e("./ui"),u=e("chess.js");t.AnalysisBoard=class{constructor(e,r){this.shapes=new i.Shapes,this.positionMap={},this.stockfishQueue=new n.StockfishQueue(e,()=>this.allComplete(),({})=>{}),this.chessground=r}config(e){return{fen:e,drawable:{enabled:!1},selectable:{enabled:!1},highlight:{lastMove:!0,check:!1},draggable:{deleteOnDropOff:!0},movable:{events:{after:()=>s.Ui.setFen(a.Util.repairFen(this.chessground.getFen(),s.Ui.sideToPlay()))}}}}allComplete(){let e={win:0,lose:0,drawn:0};Object.keys(this.positionMap).forEach(r=>{let t=this.positionMap[r];t&&t.score&&e[t.score]++}),s.Ui.setStatus(`Perturbing piece on ${s.Ui.perturbed()} results in positions with ${e.win} wins, ${e.lose} loses and ${e.drawn} draws.`),this.updateExplorerView()}perturb(e,r){this.clear(),this.positionMap={},this.chessground.set(this.config(e));var t=new o.Generator(e).perturb(r);t.sort((e,t)=>a.Util.distance(e.targetSquare,r)-a.Util.distance(t.targetSquare,r)),t.forEach(e=>{this.positionMap[e.targetSquare]=e,this.stockfishQueue.enqueue(e,e=>{this.annotate(e)})})}updateExplorerView(){var e=(new u.Chess).SQUARES,r="";e.forEach(e=>{let t=this.positionMap[e],n=t?e:"-",o=t?t.targetSquare:"",i="explorer "+(t&&t.score?t.score:"");r+=s.Ui.button(n,i,`showFenAndPv('${o}')`),e.includes("h")&&(r+="<br/>")}),s.Ui.setExplorerView(r)}depth(e){this.stockfishQueue.depth=e}selectMode(e){this.onSelect=e,this.chessground.set({movable:{color:void 0},events:{select:e=>this.selectPerturbedPiece(e)}})}placePieceMode(e,r){this.chessground.set({movable:{color:void 0},events:{select:t=>this.addPiece({type:e,color:r},t)}})}addPiece(e,r){var t=this.chessground.getFen()+" w - - 0 2",n=new u.Chess(t);n.put(e,r),this.showFen(n.fen()),this.chessground.set({movable:{color:"both"},events:{select:void 0}})}selectPerturbedPiece(e){this.chessground.set({lastMove:[e],movable:{color:"both"},events:{select:void 0}}),this.onSelect(e)}clear(){this.shapes.clear(),this.chessground.setShapes(this.shapes.shapes)}fenForTarget(e){return this.positionMap[e].fen}showFenAndPv(e){let r=this.positionMap[e],t=this.shapes.pv(r);this.chessground.set({fen:r.fen}),this.chessground.setShapes([...this.shapes.shapes,...t])}showFen(e){this.chessground.set({fen:e}),s.Ui.setFen(e)}annotate(e){this.shapes.annotate(e),this.chessground.setShapes(this.shapes.shapes)}}},{"./generator":25,"./shapes":28,"./stockfishqueue":29,"./ui":30,"./util":31,"chess.js":1}],24:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.event=e}isComplete(){return!!n.completePattern.exec(this.event)}bestMove(){var e=n.completePattern.exec(this.event);return e?e[1]:""}pv(){var e=n.pvPattern.exec(this.event);return e?e[1].split(" "):[]}score(){var e=n.matePattern.exec(this.event);return e?this.scoreMate(e[1]):(e=n.centipawnPattern.exec(this.event))?this.scoreCp(e[1]):"noScore"}scoreCp(e){return e<150&&e>-150?"drawn":e>0?"win":"lose"}scoreMate(e){return e>0?"win":"lose"}}t.Event=n,n.matePattern=/score mate ([^ ]*) .*/,n.centipawnPattern=/score cp ([^ ]*) .*/,n.completePattern=/bestmove (....)/,n.pvPattern=/ pv (.*)/},{}],25:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("chess.js"),o=e("./position"),i=e("./util");t.Generator=class{constructor(e){this.chess=new n.Chess(e)}perturb(e){const r=this.chess.get(e);if(!r)return[];const t=new n.Chess(this.chess.fen());t.remove(e);var i=[];return this.candidateSquares(r).forEach(e=>{const n=this.validFen(r,e,t);n&&i.push(new o.Position(n,e))}),i}candidateSquares(e){return"p"==e.type?this.chess.SQUARES.filter(e=>/.[2-7]/.test(e)):this.chess.SQUARES}validFen(e,r,t){if(!t.get(r)){t.put(e,r);const n=t.fen(),o=t.in_check(),i=t.in_stalemate();if(t.remove(r),!o&&!i&&this.validForOtherSide(n))return n}}validForOtherSide(e){return!new n.Chess(i.Util.fenForOtherSide(e)).in_check()}}},{"./position":27,"./util":31,"chess.js":1}],26:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./stockfishqueue");t.StockfishQueue=n.StockfishQueue;var o=e("./generator");t.Generator=o.Generator;var i=e("./position");t.Position=i.Position;var a=e("./analysisboard");t.AnalysisBoard=a.AnalysisBoard;var s=e("./ui");t.Ui=s.Ui;var u=e("./util");t.Util=u.Util;var c=e("chessground");t.Chessground=c.Chessground;var l=e("search-params");t.parse=l.parse,t.build=l.build},{"./analysisboard":23,"./generator":25,"./position":27,"./stockfishqueue":29,"./ui":30,"./util":31,chessground:5,"search-params":20}],27:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Position=class{constructor(e,r){this.fen=e,this.targetSquare=r}}},{}],28:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Shapes=class{constructor(){this.shapes=[]}clear(){this.shapes=[]}annotate(e){this.shapes.push(this.circle(e))}circle(e){return{orig:e.targetSquare,brush:this.brush(e.score)}}pv(e){return e.pv.slice(0,4).map((r,t)=>this.line(r,Math.max((16-t)/2,2),t%2==0?this.brush(e.score):this.altBrush(e.score)))}line(e,r,t){return{orig:e.substring(0,2),dest:e.substring(2,4),brush:t,modifiers:{lineWidth:r}}}altBrush(e){switch(e){case"win":return"red";case"lose":return"green";default:return"blue"}}brush(e){switch(e){case"win":return"green";case"lose":return"red";case"drawn":return"yellow";default:return"blue"}}}},{}],29:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("./event");class o{constructor(e,r){this.position=e,this.onComplete=r}}t.StockfishQueue=class{constructor(e,r,t){this.workItems=[],this.stockfish=e,this.allComplete=r,this.log=t,this.depth=8,this.send("setoption name MultiPV value 1"),this.stockfish.addEventListener("message",e=>{this.sfEventHandler(e.data)})}sfEventHandler(e){const r=new n.Event(e);if(0!=this.workItems.length){if(r.isComplete()){let e=this.workItems.shift();return e.position.bestMove=r.bestMove(),this.log(e.position),e.onComplete(e.position),void(this.workItems.length>0?this.processNextWorkItem():this.allComplete())}var t=r.score();if("noScore"!=t)return this.workItems[0].position.score=t,void(this.workItems[0].position.pv=r.pv());this.log("ignored event: "+e)}}enqueue(e,r){this.workItems.push(new o(e,r)),1==this.workItems.length&&this.processNextWorkItem()}processNextWorkItem(){let e=this.workItems[0].position.fen;this.send("position fen "+e),this.send("go depth "+this.depth)}send(e){this.stockfish.postMessage(e),this.log(e)}}},{"./event":24}],30:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Ui=class{static setStatus(e,r){let t=document.getElementById("status");t&&(t.innerHTML=e,t.style.backgroundColor=r||"black")}static setExplorerView(e){let r=document.getElementById("explorer");r&&(r.innerHTML=e)}static setFen(e){let r=document.getElementById("fen");r&&(r.value=e)}static button(e,r,t){return`<button class="${r}" type="button" onClick="${t}">${e}</button>`}static sideToPlay(){return document.getElementById("colour").checked?"w":"b"}static perturbed(){return document.getElementById("perturb").value}}},{}],31:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static fullFen(e){return 4==e.trim().split(" ").length?e.includes(" w ")?e+" 0 2":e+" 0 1":e}static fenForOtherSide(e){return e.includes(" w ")?e.replace(/ w .*/," b - - 0 1"):e.replace(/ b .*/," w - - 0 2")}static coordinates(e){return{x:e.charCodeAt(0)-"a".charCodeAt(0)+1,y:Number(e.substring(1,2))}}static distance(e,r){let t=n.coordinates(e),o=n.coordinates(r);return Math.max(Math.abs(t.x-o.x),Math.abs(t.y-o.y))}static repairFen(e,r){return e.split(" ")[0]+("w"==r?" w - - 0 2":" b - - 0 1")}}t.Util=n},{}]},{},[26])(26)}));