!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=e()}}(function(){return function i(a,s,c){function u(r,e){if(!s[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(l)return l(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[r]={exports:{}};a[r][0].call(o.exports,function(e){return u(a[r][1][e]||e)},o,o.exports,i,a,s,c)}return s[r].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,r,t){var n=function(e){var u="b",l="w",c=-1,y="p",w="n",k="b",P="r",E="q",f="k",n="pnbrqkPNBRQK",r="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",v=["1-0","0-1","1/2-1/2","*"],_={b:[16,32,17,15],w:[-16,-32,-17,-15]},S={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},d=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],p=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],h={p:0,n:1,b:2,r:3,q:4,k:5},o={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},C={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},A=7,O=6,M=1,T=0,I={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},g={w:[{square:I.a1,flag:C.QSIDE_CASTLE},{square:I.h1,flag:C.KSIDE_CASTLE}],b:[{square:I.a8,flag:C.QSIDE_CASTLE},{square:I.h8,flag:C.KSIDE_CASTLE}]},q=new Array(128),N={w:c,b:c},x=l,L={w:0,b:0},K=c,b=0,m=1,D=[],R={};function s(){q=new Array(128),N={w:c,b:c},x=l,L={w:0,b:0},K=c,b=0,m=1,D=[],R={},F(B())}function j(){Q(r)}function Q(e){var r=e.split(/\s+/),t=r[0],n=0;if(!U(e).valid)return!1;s();for(var o=0;o<t.length;o++){var i=t.charAt(o);if("/"===i)n+=8;else if(-1!=="0123456789".indexOf(i))n+=parseInt(i,10);else{var a=i<"a"?l:u;G({type:i.toLowerCase(),color:a},ae(n)),n++}}return x=r[1],-1<r[2].indexOf("K")&&(L.w|=C.KSIDE_CASTLE),-1<r[2].indexOf("Q")&&(L.w|=C.QSIDE_CASTLE),-1<r[2].indexOf("k")&&(L.b|=C.KSIDE_CASTLE),-1<r[2].indexOf("q")&&(L.b|=C.QSIDE_CASTLE),K="-"===r[3]?c:I[r[3]],b=parseInt(r[4],10),m=parseInt(r[5],10),F(B()),!0}function U(e){var r="No errors.",t="FEN string must contain six space-delimited fields.",n="6th field (move number) must be a positive integer.",o="5th field (half move counter) must be a non-negative integer.",i="4th field (en-passant square) is invalid.",a="3rd field (castling availability) is invalid.",s="2nd field (side to move) is invalid.",c="1st field (piece positions) does not contain 8 '/'-delimited rows.",u="1st field (piece positions) is invalid [consecutive numbers].",l="1st field (piece positions) is invalid [invalid piece].",f="1st field (piece positions) is invalid [row too large].",d="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:t};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:n};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:o};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:i};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:a};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:s};var v=p[0].split("/");if(8!==v.length)return{valid:!1,error_number:7,error:c};for(var h=0;h<v.length;h++){for(var g=0,b=!1,m=0;m<v[h].length;m++)if(isNaN(v[h][m])){if(!/^[prnbqkPRNBQK]$/.test(v[h][m]))return{valid:!1,error_number:9,error:l};g+=1,b=!1}else{if(b)return{valid:!1,error_number:8,error:u};g+=parseInt(v[h][m],10),b=!0}if(8!==g)return{valid:!1,error_number:10,error:f}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:d}:{valid:!0,error_number:0,error:r}}function B(){for(var e=0,r="",t=I.a8;t<=I.h1;t++){if(null==q[t])e++;else{0<e&&(r+=e,e=0);var n=q[t].color,o=q[t].type;r+=n===l?o.toUpperCase():o.toLowerCase()}t+1&136&&(0<e&&(r+=e),t!==I.h1&&(r+="/"),e=0,t+=8)}var i="";L[l]&C.KSIDE_CASTLE&&(i+="K"),L[l]&C.QSIDE_CASTLE&&(i+="Q"),L[u]&C.KSIDE_CASTLE&&(i+="k"),L[u]&C.QSIDE_CASTLE&&(i+="q"),i=i||"-";var a=K===c?"-":ae(K);return[r,x,i,a,b,m].join(" ")}function W(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(R[e[r]]=e[r+1]);return R}function F(e){0<D.length||(e!==r?(R.SetUp="1",R.FEN=e):(delete R.SetUp,delete R.FEN))}function i(e){var r=q[I[e]];return r?{type:r.type,color:r.color}:null}function G(e,r){if(!("type"in e&&"color"in e))return!1;if(-1===n.indexOf(e.type.toLowerCase()))return!1;if(!(r in I))return!1;var t=I[r];return(e.type!=f||N[e.color]==c||N[e.color]==t)&&(q[t]={type:e.type,color:e.color},e.type===f&&(N[e.color]=t),F(B()),!0)}function H(e,r,t,n,o){var i={color:x,from:r,to:t,flags:n,piece:e[r].type};return o&&(i.flags|=C.PROMOTION,i.promotion=o),e[t]?i.captured=e[t].type:n&C.EP_CAPTURE&&(i.captured=y),i}function $(e){function r(e,r,t,n,o){if(e[t].type!==y||oe(n)!==T&&oe(n)!==A)r.push(H(e,t,n,o));else for(var i=[E,P,k,w],a=0,s=i.length;a<s;a++)r.push(H(e,t,n,o,i[a]))}var t=[],n=x,o=se(n),i={b:M,w:O},a=I.a8,s=I.h1,c=!1,u=!(void 0!==e&&"legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in I))return[];a=s=I[e.square],c=!0}for(var l=a;l<=s;l++)if(136&l)l+=7;else{var f=q[l];if(null!=f&&f.color===n)if(f.type===y){var d=l+_[n][0];if(null==q[d]){r(q,t,l,d,C.NORMAL);d=l+_[n][1];i[n]===oe(l)&&null==q[d]&&r(q,t,l,d,C.BIG_PAWN)}for(p=2;p<4;p++){136&(d=l+_[n][p])||(null!=q[d]&&q[d].color===o?r(q,t,l,d,C.CAPTURE):d===K&&r(q,t,l,K,C.EP_CAPTURE))}}else for(var p=0,v=S[f.type].length;p<v;p++){var h=S[f.type][p];for(d=l;!(136&(d+=h));){if(null!=q[d]){if(q[d].color===n)break;r(q,t,l,d,C.CAPTURE);break}if(r(q,t,l,d,C.NORMAL),"n"===f.type||"k"===f.type)break}}}if(!c||s===N[n]){if(L[n]&C.KSIDE_CASTLE){var g=(b=N[n])+2;null!=q[b+1]||null!=q[g]||Z(o,N[n])||Z(o,b+1)||Z(o,g)||r(q,t,N[n],g,C.KSIDE_CASTLE)}if(L[n]&C.QSIDE_CASTLE){var b;g=(b=N[n])-2;null!=q[b-1]||null!=q[b-2]||null!=q[b-3]||Z(o,N[n])||Z(o,b-1)||Z(o,g)||r(q,t,N[n],g,C.QSIDE_CASTLE)}}if(!u)return t;var m=[];for(l=0,v=t.length;l<v;l++)re(t[l]),V(n)||m.push(t[l]),te();return m}function X(e,r){var t="";if(e.flags&C.KSIDE_CASTLE)t="O-O";else if(e.flags&C.QSIDE_CASTLE)t="O-O-O";else{var n=function(e,r){for(var t=$({legal:!r}),n=e.from,o=e.to,i=e.piece,a=0,s=0,c=0,u=0,l=t.length;u<l;u++){var f=t[u].from,d=t[u].to,p=t[u].piece;i===p&&n!==f&&o===d&&(a++,oe(n)===oe(f)&&s++,ie(n)===ie(f)&&c++)}if(0<a)return 0<s&&0<c?ae(n):0<c?ae(n).charAt(1):ae(n).charAt(0);return""}(e,r);e.piece!==y&&(t+=e.piece.toUpperCase()+n),e.flags&(C.CAPTURE|C.EP_CAPTURE)&&(e.piece===y&&(t+=ae(e.from)[0]),t+="x"),t+=ae(e.to),e.flags&C.PROMOTION&&(t+="="+e.promotion.toUpperCase())}return re(e),a()&&(Y()?t+="#":t+="+"),te(),t}function z(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Z(e,r){for(var t=I.a8;t<=I.h1;t++)if(136&t)t+=7;else if(null!=q[t]&&q[t].color===e){var n=q[t],o=t-r,i=o+119;if(d[i]&1<<h[n.type]){if(n.type===y){if(0<o){if(n.color===l)return!0}else if(n.color===u)return!0;continue}if("n"===n.type||"k"===n.type)return!0;for(var a=p[i],s=t+a,c=!1;s!==r;){if(null!=q[s]){c=!0;break}s+=a}if(!c)return!0}}return!1}function V(e){return Z(se(e),N[e])}function a(){return V(x)}function Y(){return a()&&0===$().length}function t(){return!a()&&0===$().length}function J(){for(var e={},r=[],t=0,n=0,o=I.a8;o<=I.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var i=q[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===k&&r.push(n),t++)}if(2===t)return!0;if(3===t&&(1===e[k]||1===e[w]))return!0;if(t===e[k]+2){var a=0,s=r.length;for(o=0;o<s;o++)a+=r[o];if(0===a||a===s)return!0}return!1}function ee(){for(var e=[],r={},t=!1;;){var n=te();if(!n)break;e.push(n)}for(;;){var o=B().split(" ").slice(0,4).join(" ");if(r[o]=o in r?r[o]+1:1,3<=r[o]&&(t=!0),!e.length)break;re(e.pop())}return t}function re(e){var r,t=x,n=se(t);if(r=e,D.push({move:r,kings:{b:N.b,w:N.w},turn:x,castling:{b:L.b,w:L.w},ep_square:K,half_moves:b,move_number:m}),q[e.to]=q[e.from],q[e.from]=null,e.flags&C.EP_CAPTURE&&(x===u?q[e.to-16]=null:q[e.to+16]=null),e.flags&C.PROMOTION&&(q[e.to]={type:e.promotion,color:t}),q[e.to].type===f){if(N[q[e.to].color]=e.to,e.flags&C.KSIDE_CASTLE){var o=e.to-1,i=e.to+1;q[o]=q[i],q[i]=null}else if(e.flags&C.QSIDE_CASTLE){o=e.to+1,i=e.to-2;q[o]=q[i],q[i]=null}L[t]=""}if(L[t])for(var a=0,s=g[t].length;a<s;a++)if(e.from===g[t][a].square&&L[t]&g[t][a].flag){L[t]^=g[t][a].flag;break}if(L[n])for(a=0,s=g[n].length;a<s;a++)if(e.to===g[n][a].square&&L[n]&g[n][a].flag){L[n]^=g[n][a].flag;break}K=e.flags&C.BIG_PAWN?"b"===x?e.to-16:e.to+16:c,e.piece===y?b=0:e.flags&(C.CAPTURE|C.EP_CAPTURE)?b=0:b++,x===u&&m++,x=se(x)}function te(){var e=D.pop();if(null==e)return null;var r=e.move;N=e.kings,x=e.turn,L=e.castling,K=e.ep_square,b=e.half_moves,m=e.move_number;var t,n,o=x,i=se(x);if(q[r.from]=q[r.to],q[r.from].type=r.piece,q[r.to]=null,r.flags&C.CAPTURE)q[r.to]={type:r.captured,color:i};else if(r.flags&C.EP_CAPTURE){var a;a=o===u?r.to-16:r.to+16,q[a]={type:y,color:i}}r.flags&(C.KSIDE_CASTLE|C.QSIDE_CASTLE)&&(r.flags&C.KSIDE_CASTLE?(t=r.to+1,n=r.to-1):r.flags&C.QSIDE_CASTLE&&(t=r.to-2,n=r.to+1),q[t]=q[n],q[n]=null);return r}function ne(e,r){var t=z(e);if(r){var n=t.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(n)var o=n[1],i=n[2],a=n[3],s=n[4]}for(var c=$(),u=0,l=c.length;u<l;u++){if(t===z(X(c[u]))||r&&t===z(X(c[u],!0)))return c[u];if(n&&(!o||o.toLowerCase()==c[u].piece)&&I[i]==c[u].from&&I[a]==c[u].to&&(!s||s.toLowerCase()==c[u].promotion))return c[u]}return null}function oe(e){return e>>4}function ie(e){return 15&e}function ae(e){var r=ie(e),t=oe(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(t,t+1)}function se(e){return e===l?u:l}function ce(e){var r=function e(r){var t=r instanceof Array?[]:{};for(var n in r)t[n]="object"==typeof n?e(r[n]):r[n];return t}(e);r.san=X(r,!1),r.to=ae(r.to),r.from=ae(r.from);var t="";for(var n in C)C[n]&r.flags&&(t+=o[n]);return r.flags=t,r}function ue(e){return e.replace(/^\s+|\s+$/g,"")}return Q(void 0===e?r:e),{WHITE:l,BLACK:u,PAWN:y,KNIGHT:w,BISHOP:k,ROOK:P,QUEEN:E,KING:f,SQUARES:function(){for(var e=[],r=I.a8;r<=I.h1;r++)136&r?r+=7:e.push(ae(r));return e}(),FLAGS:o,load:function(e){return Q(e)},reset:function(){return j()},moves:function(e){for(var r=$(e),t=[],n=0,o=r.length;n<o;n++)void 0!==e&&"verbose"in e&&e.verbose?t.push(ce(r[n])):t.push(X(r[n],!1));return t},in_check:function(){return a()},in_checkmate:function(){return Y()},in_stalemate:function(){return t()},in_draw:function(){return 100<=b||t()||J()||ee()},insufficient_material:function(){return J()},in_threefold_repetition:function(){return ee()},game_over:function(){return 100<=b||Y()||t()||J()||ee()},validate_fen:function(e){return U(e)},fen:function(){return B()},pgn:function(e){var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",t="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,n=[],o=!1;for(var i in R)n.push("["+i+' "'+R[i]+'"]'+r),o=!0;o&&D.length&&n.push(r);for(var a=[];0<D.length;)a.push(te());for(var s=[],c="";0<a.length;){var u=a.pop();D.length||"b"!==u.color?"w"===u.color&&(c.length&&s.push(c),c=m+"."):c=m+". ...",c=c+" "+X(u,!1),re(u)}if(c.length&&s.push(c),void 0!==R.Result&&s.push(R.Result),0===t)return n.join("")+s.join(" ");var l=0;for(i=0;i<s.length;i++)l+s[i].length>t&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(r),l=0):0!==i&&(n.push(" "),l++),n.push(s[i]),l+=s[i].length;return n.join("")},load_pgn:function(e,r){var t=void 0!==r&&"sloppy"in r&&r.sloppy;function c(e){return e.replace(/\\/g,"\\")}var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",o=new RegExp("^(\\[(.|"+c(n)+")*\\])("+c(n)+")*1.("+c(n)+"|.)*$","g"),i=e.replace(o,"$1");"["!==i[0]&&(i=""),j();var a=function(e,r){for(var t="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",n={},o=e.split(new RegExp(c(t))),i="",a="",s=0;s<o.length;s++)i=o[s].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=o[s].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),0<ue(i).length&&(n[i]=a);return n}(i,r);for(var s in a)W([s,a[s]]);if("1"===a.SetUp&&!("FEN"in a&&Q(a.FEN)))return!1;var u=e.replace(i,"").replace(new RegExp(c(n),"g")," ");u=u.replace(/(\{[^}]+\})+?/g,"");for(var l=/(\([^\(\)]+\))+?/g;l.test(u);)u=u.replace(l,"");var f=ue(u=(u=(u=u.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");for(var d="",p=0;p<f.length-1;p++){if(null==(d=ne(f[p],t)))return!1;re(d)}if(d=f[f.length-1],-1<v.indexOf(d))(function(e){for(var r in e)return!0;return!1})(R)&&void 0===R.Result&&W(["Result",d]);else{if(null==(d=ne(d,t)))return!1;re(d)}return!0},header:function(){return W(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",r=I.a8;r<=I.h1;r++){if(0===ie(r)&&(e+=" "+"87654321"[oe(r)]+" |"),null==q[r])e+=" . ";else{var t=q[r].type;e+=" "+(q[r].color===l?t.toUpperCase():t.toLowerCase())+" "}r+1&136&&(e+="|\n",r+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}()},turn:function(){return x},move:function(e,r){var t=void 0!==r&&"sloppy"in r&&r.sloppy,n=null;if("string"==typeof e)n=ne(e,t);else if("object"==typeof e)for(var o=$(),i=0,a=o.length;i<a;i++)if(!(e.from!==ae(o[i].from)||e.to!==ae(o[i].to)||"promotion"in o[i]&&e.promotion!==o[i].promotion)){n=o[i];break}if(!n)return null;var s=ce(n);return re(n),s},undo:function(){var e=te();return e?ce(e):null},clear:function(){return s()},put:function(e,r){return G(e,r)},get:function(e){return i(e)},remove:function(e){return t=i(r=e),q[I[r]]=null,t&&t.type===f&&(N[t.color]=c),F(B()),t;var r,t},perft:function(e){return function e(r){for(var t=$({legal:!1}),n=0,o=x,i=0,a=t.length;i<a;i++)re(t[i]),V(o)||(0<r-1?n+=e(r-1):n++),te();return n}(e)},square_color:function(e){if(e in I){var r=I[e];return(oe(r)+ie(r))%2==0?"light":"dark"}return null},history:function(e){for(var r=[],t=[],n=(void 0!==e&&"verbose"in e&&e.verbose);0<D.length;)r.push(te());for(;0<r.length;){var o=r.pop();n?t.push(ce(o)):t.push(X(o)),re(o)}return t}}};void 0!==t&&(t.Chess=n)},{}],2:[function(e,r,t){"use strict";var a=this&&this.__assign||Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var h=e("./util");function n(e,r){var t=e(r);return r.dom.redraw(),t}function g(e,r){return{key:e,pos:h.key2pos(e),piece:r}}t.anim=function(e,r){return r.animation.enabled?function(e,r){var t=a({},r.pieces),n=e(r),o=function(e,r){var t,n,o,i,a={},s=[],c={},u=[],l=[],f={};for(o in e)f[o]=g(o,e[o]);for(var d=0,p=h.allKeys;d<p.length;d++){var v=p[d];t=r.pieces[v],n=f[v],t?n?h.samePiece(t,n.piece)||(u.push(n),l.push(g(v,t))):l.push(g(v,t)):n&&u.push(n)}return l.forEach(function(r){var t,e;t=r,e=u.filter(function(e){return h.samePiece(r.piece,e.piece)}),(n=e.sort(function(e,r){return h.distanceSq(t.pos,e.pos)-h.distanceSq(t.pos,r.pos)})[0])&&(i=[n.pos[0]-r.pos[0],n.pos[1]-r.pos[1]],a[r.key]=i.concat(i),s.push(n.key))}),u.forEach(function(e){h.containsX(s,e.key)||r.items&&r.items(e.pos,e.key)||(c[e.key]=e.piece)}),{anims:a,fadings:c}}(t,r);if(s(o.anims)&&s(o.fadings))r.dom.redraw();else{var i=r.animation.current&&r.animation.current.start;r.animation.current={start:u.now(),frequency:1/r.animation.duration,plan:o},i||function r(t,e){var n=t.animation.current;if(void 0!==n){var o,i=1-(e-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{var a=(o=i)<.5?4*o*o*o:(o-1)*(2*o-2)*(2*o-2)+1;for(var s in n.plan.anims){var c=n.plan.anims[s];c[2]=c[0]*a,c[3]=c[1]*a}t.dom.redrawNow(!0),h.raf(function(e){return void 0===e&&(e=u.now()),r(t,e)})}}else t.dom.destroyed||t.dom.redrawNow()}(r,u.now())}return n}(e,r):n(e,r)},t.render=n;var u=void 0!==window.performance?window.performance:Date;function s(e){for(var r in e)return!1;return!0}},{"./util":17}],3:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./board"),i=e("./fen"),a=e("./config"),s=e("./anim"),c=e("./drag"),u=e("./explosion");t.start=function(n,e){function t(){o.toggleOrientation(n),e()}return{set:function(r){r.orientation&&r.orientation!==n.orientation&&t(),(r.fen?s.anim:s.render)(function(e){return a.configure(e,r)},n)},state:n,getFen:function(){return i.write(n.pieces)},toggleOrientation:t,setPieces:function(r){s.anim(function(e){return o.setPieces(e,r)},n)},selectSquare:function(r,t){r?s.anim(function(e){return o.selectSquare(e,r,t)},n):n.selected&&(o.unselect(n),n.dom.redraw())},move:function(r,t){s.anim(function(e){return o.baseMove(e,r,t)},n)},newPiece:function(r,t){s.anim(function(e){return o.baseNewPiece(e,r,t)},n)},playPremove:function(){if(n.premovable.current){if(s.anim(o.playPremove,n))return!0;n.dom.redraw()}return!1},playPredrop:function(e){if(n.predroppable.current){var r=o.playPredrop(n,e);return n.dom.redraw(),r}return!1},cancelPremove:function(){s.render(o.unsetPremove,n)},cancelPredrop:function(){s.render(o.unsetPredrop,n)},cancelMove:function(){s.render(function(e){o.cancelMove(e),c.cancel(e)},n)},stop:function(){s.render(function(e){o.stop(e),c.cancel(e)},n)},explode:function(e){u.default(n,e)},setAutoShapes:function(r){s.render(function(e){return e.drawable.autoShapes=r},n)},setShapes:function(r){s.render(function(e){return e.drawable.shapes=r},n)},getKeyAtDomPos:function(e){return o.getKeyAtDomPos(e,"white"===n.orientation,n.dom.bounds())},redrawAll:e,dragNewPiece:function(e,r,t){c.dragNewPiece(n,e,r,t)},destroy:function(){o.stop(n),n.dom.unbind&&n.dom.unbind(),n.dom.destroyed=!0}}}},{"./anim":2,"./board":4,"./config":6,"./drag":7,"./explosion":10,"./fen":11}],4:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=e("./util"),v=e("./premove");function g(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];e&&setTimeout(function(){return e.apply(void 0,r)},1)}function b(e){e.premovable.current&&(e.premovable.current=void 0,g(e.premovable.events.unset))}function m(e){var r=e.predroppable;r.current&&(r.current=void 0,g(r.events.unset))}function o(e,r,t){if(r===t||!e.pieces[r])return!1;var n=e.pieces[t]&&e.pieces[t].color!==e.pieces[r].color?e.pieces[t]:void 0;return t==e.selected&&k(e),g(e.events.move,r,t,n),function(e,r,t){if(!e.autoCastle)return!1;var n=e.pieces[r];if("king"!==n.role)return!1;var o=p.key2pos(r);if(5!==o[0])return!1;if(1!==o[1]&&8!==o[1])return!1;var i,a,s,c=p.key2pos(t);if(7===c[0]||8===c[0])i=p.pos2key([8,o[1]]),a=p.pos2key([6,o[1]]),s=p.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return!1;i=p.pos2key([1,o[1]]),a=p.pos2key([4,o[1]]),s=p.pos2key([3,o[1]])}var u=e.pieces[i];return"rook"===u.role&&(delete e.pieces[r],delete e.pieces[i],e.pieces[s]=n,e.pieces[a]=u,!0)}(e,r,t)||(e.pieces[t]=e.pieces[r],delete e.pieces[r]),e.lastMove=[r,t],e.check=void 0,g(e.events.change),n||!0}function y(e,r,t,n){if(e.pieces[t]){if(!n)return!1;delete e.pieces[t]}return g(e.events.dropNewPiece,r,t),e.pieces[t]=r,e.lastMove=[t],e.check=void 0,g(e.events.change),e.movable.dests=void 0,e.turnColor=p.opposite(e.turnColor),!0}function h(e,r,t){var n=o(e,r,t);return n&&(e.movable.dests=void 0,e.turnColor=p.opposite(e.turnColor),e.animation.current=void 0),n}function n(e,r,t){if(E(e,r,t)){var n=h(e,r,t);if(n){var o=e.hold.stop();k(e);var i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==n&&(i.captured=n),g(e.movable.events.after,r,t,i),!0}}else l=e,(f=r)!==(d=t)&&_(l,f)&&p.containsX(v.default(l.pieces,f,l.premovable.castle),d)?(s=r,c=t,u={ctrlKey:(a=e).stats.ctrlKey},m(a),a.premovable.current=[s,c],g(a.premovable.events.set,s,c,u),k(e)):P(e,t)||_(e,t)?(w(e,t),e.hold.start()):k(e);var a,s,c,u,l,f,d;return!1}function w(e,r){e.selected=r,_(e,r)?e.premovable.dests=v.default(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function k(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function P(e,r){var t=e.pieces[r];return t&&("both"===e.movable.color||e.movable.color===t.color&&e.turnColor===t.color)}function E(e,r,t){return r!==t&&P(e,r)&&(e.movable.free||!!e.movable.dests&&p.containsX(e.movable.dests[r],t))}function _(e,r){var t=e.pieces[r];return t&&e.premovable.enabled&&e.movable.color===t.color&&e.turnColor!==t.color}function i(e){b(e),m(e),k(e)}t.callUserFunction=g,t.toggleOrientation=function(e){e.orientation=p.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},t.reset=function(e){e.lastMove=void 0,k(e),b(e),m(e)},t.setPieces=function(e,r){for(var t in r){var n=r[t];n?e.pieces[t]=n:delete e.pieces[t]}},t.setCheck=function(e,r){if(!0===r&&(r=e.turnColor),r)for(var t in e.pieces)"king"===e.pieces[t].role&&e.pieces[t].color===r&&(e.check=t);else e.check=void 0},t.unsetPremove=b,t.unsetPredrop=m,t.baseMove=o,t.baseNewPiece=y,t.userMove=n,t.dropNewPiece=function(e,r,t,n){if(p=r,v=t,(h=(d=e).pieces[p])&&v&&(p===v||!d.pieces[v])&&("both"===d.movable.color||d.movable.color===h.color&&d.turnColor===h.color)||n){var o=e.pieces[r];delete e.pieces[r],y(e,o,t,n),g(e.movable.events.afterNewPiece,o.role,t,{predrop:!1})}else u=r,l=t,(f=(c=e).pieces[u])&&l&&(!c.pieces[l]||c.pieces[l].color!==c.movable.color)&&c.predroppable.enabled&&("pawn"!==f.role||"1"!==l[1]&&"8"!==l[1])&&c.movable.color===f.color&&c.turnColor!==f.color?(a=(i=e).pieces[r].role,s=t,b(i),i.predroppable.current={role:a,key:s},g(i.predroppable.events.set,a,s)):(b(e),m(e));var i,a,s,c,u,l,f,d,p,v,h;delete e.pieces[r],k(e)},t.selectSquare=function(e,r,t){e.selected?e.selected!==r||e.draggable.enabled?(e.selectable.enabled||t)&&e.selected!==r?n(e,e.selected,r)&&(e.stats.dragged=!1):e.hold.start():(k(e),e.hold.cancel()):(P(e,r)||_(e,r))&&(w(e,r),e.hold.start()),g(e.events.select,r)},t.setSelected=w,t.unselect=k,t.canMove=E,t.isDraggable=function(e,r){var t=e.pieces[r];return t&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===t.color&&(e.turnColor===t.color||e.premovable.enabled))},t.playPremove=function(e){var r=e.premovable.current;if(!r)return!1;var t=r[0],n=r[1],o=!1;if(E(e,t,n)){var i=h(e,t,n);if(i){var a={premove:!0};!0!==i&&(a.captured=i),g(e.movable.events.after,t,n,a),o=!0}}return b(e),o},t.playPredrop=function(e,r){var t=e.predroppable.current,n=!1;return!!t&&(r(t)&&y(e,{role:t.role,color:e.movable.color},t.key)&&(g(e.movable.events.afterNewPiece,t.role,t.key,{predrop:!0}),n=!0),m(e),n)},t.cancelMove=i,t.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,i(e)},t.getKeyAtDomPos=function(e,r,t){var n=Math.ceil((e[0]-t.left)/t.width*8);r||(n=9-n);var o=Math.ceil(8-(e[1]-t.top)/t.height*8);return r||(o=9-o),0<n&&n<9&&0<o&&o<9?p.pos2key([n,o]):void 0}},{"./premove":12,"./util":17}],5:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./api"),o=e("./config"),i=e("./state"),l=e("./wrap"),f=e("./events"),d=e("./render"),p=e("./svg"),v=e("./util");t.Chessground=function(s,e){var c=i.defaults();function u(){var e=c.dom&&c.dom.unbind;s.classList.add("cg-board-wrap");var r,t,n=v.memo(function(){return s.getBoundingClientRect()}),o=c.viewOnly&&!c.drawable.visible,i=l.default(s,c,o?void 0:n()),a=function(e){d.default(c),!e&&i.svg&&p.renderSvg(c,i.svg)};c.dom={elements:i,bounds:n,redraw:(r=a,t=!1,function(){t||(t=!0,v.raf(function(){r(),t=!1}))}),redrawNow:a,unbind:e,relative:o},c.drawable.prevSvgHash="",a(!1),f.bindBoard(c),e||(c.dom.unbind=f.bindDocument(c,u))}return o.configure(c,e||{}),u(),n.start(c,u)}},{"./api":3,"./config":6,"./events":9,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],6:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("./board"),a=e("./fen");function s(e){return"object"==typeof e}t.configure=function(e,r){if(r.movable&&r.movable.dests&&(e.movable.dests=void 0),function e(r,t){for(var n in t)s(r[n])&&s(t[n])?e(r[n],t[n]):r[n]=t[n]}(e,r),r.fen&&(e.pieces=a.read(r.fen),e.drawable.shapes=[]),r.hasOwnProperty("check")&&i.setCheck(e,r.check||!1),r.hasOwnProperty("lastMove")&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&i.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var t="white"===e.movable.color?1:8,n="e"+t,o=e.movable.dests[n];if(!o||"king"!==e.pieces[n].role)return;e.movable.dests[n]=o.filter(function(e){return!(e==="a"+t&&-1!==o.indexOf("c"+t)||e==="h"+t&&-1!==o.indexOf("g"+t))})}}},{"./board":4,"./fen":11}],7:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=e("./board"),h=e("./util"),g=e("./draw"),b=e("./anim");function m(a){h.raf(function(){var e=a.draggable.current;if(e){a.animation.current&&a.animation.current.plan.anims[e.orig]&&(a.animation.current=void 0);var r=a.pieces[e.orig];if(r&&h.samePiece(r,e.piece)){if(!e.started&&h.distanceSq(e.epos,e.rel)>=Math.pow(a.draggable.distance,2)&&(e.started=!0),e.started){if("function"==typeof e.element){var t=e.element();if(!t)return;e.element=t,e.element.cgDragging=!0,e.element.classList.add("dragging")}var n="white"===a.orientation,o=a.dom.bounds();e.pos=[e.epos[0]-e.rel[0],e.epos[1]-e.rel[1]];var i=h.posToTranslateAbs(o)(e.origPos,n);i[0]+=e.pos[0]+e.dec[0],i[1]+=e.pos[1]+e.dec[1],h.translateAbs(e.element,i)}}else s(a);m(a)}})}function s(e){var r=e.draggable.current;r&&(r.newPiece&&delete e.pieces[r.orig],e.draggable.current=void 0,v.unselect(e),i(e),e.dom.redraw())}function i(e){var r=e.dom.elements;r.ghost&&h.setVisible(r.ghost,!1)}function y(e,r,t){var n=h.key2pos(e);return r||(n[0]=9-n[0],n[1]=9-n[1]),{left:t.left+t.width*(n[0]-1)/8,top:t.top+t.height*(8-n[1])/8,width:t.width/8,height:t.height/8}}function w(e,r){for(var t=e.dom.elements.board.firstChild;t;){if(t.cgKey===r&&"PIECE"===t.tagName)return t;t=t.nextSibling}}t.start=function(e,r){if(!(void 0!==r.button&&0!==r.button||r.touches&&1<r.touches.length)){r.preventDefault();var t="white"===e.orientation,n=e.dom.bounds(),o=h.eventPosition(r),i=v.getKeyAtDomPos(o,t,n);if(i){var a=e.pieces[i],s=e.selected;s||!e.drawable.enabled||!e.drawable.eraseOnClick&&a&&a.color===e.turnColor||g.clear(e);var c=!!e.premovable.current,u=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&v.canMove(e,e.selected,i)?b.anim(function(e){return v.selectSquare(e,i)},e):v.selectSquare(e,i);var l=e.selected===i,f=w(e,i);if(a&&f&&l&&v.isDraggable(e,i)){var d=y(i,t,n);e.draggable.current={orig:i,origPos:h.key2pos(i),piece:a,rel:o,epos:o,pos:[0,0],dec:e.draggable.centerPiece?[o[0]-(d.left+d.width/2),o[1]-(d.top+d.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:f,previouslySelected:s,originTarget:r.target},f.cgDragging=!0,f.classList.add("dragging");var p=e.dom.elements.ghost;p&&(p.className="ghost "+a.color+" "+a.role,h.translateAbs(p,h.posToTranslateAbs(n)(h.key2pos(i),t)),h.setVisible(p,!0)),m(e)}else c&&v.unsetPremove(e),u&&v.unsetPredrop(e);e.dom.redraw()}}},t.dragNewPiece=function(e,r,t,n){var o="a0";e.pieces.a0=r,e.dom.redraw();var i=h.eventPosition(t),a="white"===e.orientation,s=e.dom.bounds(),c=y(o,a,s),u=[(a?0:7)*c.width+s.left,(a?8:-1)*c.height+s.top];e.draggable.current={orig:o,origPos:h.key2pos(o),piece:r,rel:u,epos:i,pos:[i[0]-u[0],i[1]-u[1]],dec:[-c.width/2,-c.height/2],started:!0,element:function(){return w(e,o)},originTarget:t.target,newPiece:!0,force:n||!1},m(e)},t.move=function(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.epos=h.eventPosition(r))},t.end=function(e,r){var t=e.draggable.current;if(t)if("touchend"!==r.type||!t||t.originTarget===r.target||t.newPiece){v.unsetPremove(e),v.unsetPredrop(e);var n=h.eventPosition(r)||t.epos,o=v.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&t.started?t.newPiece?v.dropNewPiece(e,t.orig,o,t.force):(e.stats.ctrlKey=r.ctrlKey,v.userMove(e,t.orig,o)&&(e.stats.dragged=!0)):t.newPiece?delete e.pieces[t.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[t.orig],v.callUserFunction(e.events.change)),(!t||t.orig!==t.previouslySelected||t.orig!==o&&o)&&e.selectable.enabled||v.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},t.cancel=s},{"./anim":2,"./board":4,"./draw":8,"./util":17}],8:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("./board"),c=e("./util"),u=["green","red","blue","yellow"];function l(t){c.raf(function(){var e=t.drawable.current;if(e){var r=s.getKeyAtDomPos(e.pos,"white"===t.orientation,t.dom.bounds());r!==e.mouseSq&&(e.mouseSq=r,e.dest=r!==e.orig?r:void 0,t.dom.redrawNow()),l(t)}})}function f(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function d(e){e.onChange&&e.onChange(e.shapes)}t.start=function(e,r){if(!(r.touches&&1<r.touches.length)){r.stopPropagation(),r.preventDefault(),r.ctrlKey?s.unselect(e):s.cancelMove(e);var t,n,o,i=c.eventPosition(r),a=s.getKeyAtDomPos(i,"white"===e.orientation,e.dom.bounds());a&&(e.drawable.current={orig:a,pos:i,brush:(t=r,n=t.shiftKey&&c.isRightButton(t)?1:0,o=t.altKey?2:0,u[n+o])},l(e))}},t.processDraw=l,t.move=function(e,r){e.drawable.current&&(e.drawable.current.pos=c.eventPosition(r))},t.end=function(e){var r=e.drawable.current;r&&(r.mouseSq&&(t=e.drawable,n=r,i=function(e){return e.orig===n.orig&&e.dest===n.dest},a=t.shapes.filter(i)[0],a&&(t.shapes=t.shapes.filter((o=i,function(e){return!o(e)}))),a&&a.brush===n.brush||t.shapes.push(n),d(t)),f(e));var t,n,o,i,a},t.cancel=f,t.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),d(e.drawable))}},{"./board":4,"./util":17}],9:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("./drag"),s=e("./draw"),c=e("./util");function u(e,r,t,n){return e.addEventListener(r,t,n),function(){return e.removeEventListener(r,t)}}function l(r,t,n){return function(e){e.shiftKey||c.isRightButton(e)?r.drawable.enabled&&n(r,e):r.viewOnly||t(r,e)}}t.bindBoard=function(e){if(!e.viewOnly){var r,t=e.dom.elements.board,n=(r=e,function(e){r.draggable.current?a.cancel(r):r.drawable.current?s.cancel(r):e.shiftKey||c.isRightButton(e)?r.drawable.enabled&&s.start(r,e):r.viewOnly||a.start(r,e)});t.addEventListener("touchstart",n),t.addEventListener("mousedown",n),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",function(e){return e.preventDefault()})}},t.bindDocument=function(e,r){var t=[];!e.dom.relative&&e.resizable&&t.push(u(document.body,"chessground.resize",function(){e.dom.bounds.clear(),c.raf(r)}));if(!e.viewOnly){var n=l(e,a.move,s.move),o=l(e,a.end,s.end);["touchmove","mousemove"].forEach(function(e){return t.push(u(document,e,n))}),["touchend","mouseup"].forEach(function(e){return t.push(u(document,e,o))});var i=function(){return e.dom.bounds.clear()};t.push(u(window,"scroll",i,{passive:!0})),t.push(u(window,"resize",i,{passive:!0}))}return function(){return t.forEach(function(e){return e()})}}},{"./drag":7,"./draw":8,"./util":17}],10:[function(e,r,t){"use strict";function n(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(function(){n(e,2),setTimeout(function(){return n(e,void 0)},120)},120)}},{}],11:[function(e,r,u){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var l=e("./util"),i=e("./types");u.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var f={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};u.read=function(e){"start"===e&&(e=u.initial);for(var r={},t=8,n=0,o=0,i=e;o<i.length;o++){var a=i[o];switch(a){case" ":return r;case"/":if(0==--t)return r;n=0;break;case"~":r[l.pos2key([n,t])].promoted=!0;break;default:var s=a.charCodeAt(0);if(s<57)n+=s-48;else{++n;var c=a.toLowerCase();r[l.pos2key([n,t])]={role:f[c],color:a===c?"black":"white"}}}}return r},u.write=function(t){var n,o;return l.invRanks.map(function(r){return i.ranks.map(function(e){return(n=t[l.pos2key([e,r])])?(o=a[n.role],"white"===n.color?o.toUpperCase():o):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}},{"./types":16,"./util":17}],12:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=e("./util");function v(e,r){return Math.abs(e-r)}var h=function(e,r,t,n){var o=v(e,t),i=v(r,n);return 1===o&&2===i||2===o&&1===i},g=function(e,r,t,n){return v(e,t)===v(r,n)},b=function(e,r,t,n){return e===t||r===n},m=function(e,r,t,n){return g(e,r,t,n)||b(e,r,t,n)};t.default=function(e,r,t){var n,o,i,a,s,c,u,l,f=e[r],d=p.key2pos(r);switch(f.role){case"pawn":l=f.color,n=function(e,r,t,n){return v(e,t)<2&&("white"===l?n===r+1||r<=2&&n===r+2&&e===t:n===r-1||7<=r&&n===r-2&&e===t)};break;case"knight":n=h;break;case"bishop":n=g;break;case"rook":n=b;break;case"queen":n=m;break;case"king":o=f.color,s=e,c=f.color,i=Object.keys(s).filter(function(e){return(u=s[e])&&u.color===c&&"rook"===u.role}).map(function(e){return p.key2pos(e)[0]}),a=t,n=function(e,r,t,n){return v(e,t)<2&&v(r,n)<2||a&&r===n&&r===("white"===o?1:8)&&(5===e&&(3===t||7===t)||p.containsX(i,t))}}return p.allKeys.map(p.key2pos).filter(function(e){return(d[0]!==e[0]||d[1]!==e[1])&&n(d[0],d[1],e[0],e[1])}).map(p.pos2key)}},{"./util":17}],13:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var K=e("./util"),D=e("./util");function R(e,r){for(var t in r)e.dom.elements.board.removeChild(r[t])}function j(e,r){var t=2+8*(e[1]-1)+(8-e[0]);return r&&(t=67-t),t+""}function Q(e){return e.color+" "+e.role}function U(e,r,t){e[r]?e[r]+=" "+t:e[r]=t}t.default=function(e){var r,t,n,o,i,a,s,c,u,l,f,d="white"===e.orientation,p=e.dom.relative?D.posToTranslateRel:D.posToTranslateAbs(e.dom.bounds()),v=e.dom.relative?D.translateRel:D.translateAbs,h=e.dom.elements.board,g=e.pieces,b=e.animation.current,m=b?b.plan.anims:{},y=b?b.plan.fadings:{},w=e.draggable.current,k=function(e){var r,t,n={};if(e.lastMove&&e.highlight.lastMove)for(r in e.lastMove)U(n,e.lastMove[r],"last-move");if(e.check&&e.highlight.check&&U(n,e.check,"check"),e.selected&&(U(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(r in o)t=o[r],U(n,t,"move-dest"+(e.pieces[t]?" oc":""));var i=e.premovable.dests;if(i)for(r in i)t=i[r],U(n,t,"premove-dest"+(e.pieces[t]?" oc":""))}var a=e.premovable.current;if(a)for(r in a)U(n,a[r],"current-premove");else e.predroppable.current&&U(n,e.predroppable.current.key,"current-premove");var s=e.exploding;if(s)for(r in s.keys)U(n,s.keys[r],"exploding"+s.stage);return n}(e),P={},E={},_={},S={},C=Object.keys(g);for(n=h.firstChild;n;){if(r=n.cgKey,"PIECE"===n.tagName)o=g[r],a=m[r],s=y[r],i=n.cgPiece,!n.cgDragging||w&&w.orig===r||(n.classList.remove("dragging"),v(n,p(K.key2pos(r),d)),n.cgDragging=!1),!s&&n.cgFading&&(n.cgFading=!1,n.classList.remove("fading")),o?(a&&n.cgAnimating&&i===Q(o)?((q=K.key2pos(r))[0]+=a[2],q[1]+=a[3],n.classList.add("anim"),v(n,p(q,d))):n.cgAnimating&&(n.cgAnimating=!1,n.classList.remove("anim"),v(n,p(K.key2pos(r),d)),e.addPieceZIndex&&(n.style.zIndex=j(K.key2pos(r),d))),i!==Q(o)||s&&n.cgFading?s&&i===Q(s)?(n.classList.add("fading"),n.cgFading=!0):_[i]?_[i].push(n):_[i]=[n]:P[r]=!0):_[i]?_[i].push(n):_[i]=[n];else if("SQUARE"===n.tagName){var A=n.className;k[r]===A?E[r]=!0:S[A]?S[A].push(n):S[A]=[n]}n=n.nextSibling}for(var O in k)if(!E[O]){f=(l=S[k[O]])&&l.pop();var M=p(K.key2pos(O),d);if(f)f.cgKey=O,v(f,M);else{var T=K.createEl("square",k[O]);T.cgKey=O,v(T,M),h.insertBefore(T,h.firstChild)}}for(var I in C)if(t=g[r=C[I]],a=m[r],!P[r])if(u=(c=_[Q(t)])&&c.pop()){u.cgKey=r,u.cgFading&&(u.classList.remove("fading"),u.cgFading=!1);var q=K.key2pos(r);e.addPieceZIndex&&(u.style.zIndex=j(q,d)),a&&(u.cgAnimating=!0,u.classList.add("anim"),q[0]+=a[2],q[1]+=a[3]),v(u,p(q,d))}else{var N=Q(t),x=K.createEl("piece",N);q=K.key2pos(r),x.cgPiece=N,x.cgKey=r,a&&(x.cgAnimating=!0,q[0]+=a[2],q[1]+=a[3]),v(x,p(q,d)),e.addPieceZIndex&&(x.style.zIndex=j(q,d)),h.appendChild(x)}for(var L in _)R(e,_[L]);for(var L in S)R(e,S[L])}},{"./util":17}],14:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./fen"),o=e("./util");t.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":11,"./util":17}],15:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var F,G=e("./util");function H(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function u(e,r,t){var n,o,i=e.orig,a=e.dest,s=e.brush,c=e.piece,u=e.modifiers;return[t,i,a,s,a&&1<r[a],c&&(o=c,[o.color,o.role,o.scale].filter(function(e){return e}).join("")),u&&(n=u,""+(n.lineWidth||""))].filter(function(e){return e}).join("")}function l(e){var r=$(H("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild($(H("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function $(e,r){for(var t in r)e.setAttribute(t,r[t]);return e}function X(e,r){return"white"===r?e:[9-e[0],9-e[1]]}function z(e,r){var t={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth)};return t.key=[e.key,r.lineWidth].filter(function(e){return e}).join(""),t}function Z(e,r){return(e.opacity||1)*(r?.9:1)}function V(e,r){return[(e[0]-.5)*r.width/8,(8.5-e[1])*r.height/8]}t.createElement=H,t.renderSvg=function(e,r){var t=e.drawable,n=t.current,o=n&&n.mouseSq?n:void 0,i={};t.shapes.concat(t.autoShapes).concat(o?[o]:[]).forEach(function(e){e.dest&&(i[e.dest]=(i[e.dest]||0)+1)});var a=t.shapes.concat(t.autoShapes).map(function(e){return{shape:e,current:!1,hash:u(e,i,!1)}});o&&a.push({shape:o,current:!0,hash:u(o,i,!0)});var s=a.map(function(e){return e.hash}).join("");if(s!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=s;var c=r.firstChild;!function(r,e,t){var n,o={};e.forEach(function(e){e.shape.dest&&(n=r.brushes[e.shape.brush],e.shape.modifiers&&(n=z(n,e.shape.modifiers)),o[n.key]=n)});for(var i={},a=t.firstChild;a;)i[a.getAttribute("cgKey")]=!0,a=a.nextSibling;for(var s in o)i[s]||t.appendChild(l(o[s]))}(t,a,c),function(r,e,t,n,o,i){void 0===F&&(F=G.computeIsTrident());var a=r.dom.bounds(),s={},c=[];e.forEach(function(e){s[e.hash]=!1});for(var u,l=i.nextSibling;l;)u=l.getAttribute("cgHash"),s.hasOwnProperty(u)?s[u]=!0:c.push(l),l=l.nextSibling;c.forEach(function(e){return o.removeChild(e)}),e.forEach(function(e){s[e.hash]||o.appendChild(function(e,r,t,n,o){var i,a,s,c,u,l,f,d,p,v,h,g,b,m,y,w,k,P,E,_,S,C,A,O,M,T,I,q,N,x,L,K,D,R,j=r.shape,Q=r.current,U=r.hash;if(j.piece)q=e.drawable.pieces.baseUrl,N=X(G.key2pos(j.orig),e.orientation),x=j.piece,K=V(N,L=o),D=L.width/8*(x.scale||1),R=x.color[0]+("knight"===x.role?"n":x.role[0]).toUpperCase(),i=$(H("image"),{className:x.role+" "+x.color,x:K[0]-D/2,y:K[1]-D/2,width:D,height:D,href:q+R+".svg"});else{var B=X(G.key2pos(j.orig),e.orientation);if(j.orig&&j.dest){var W=t[j.brush];j.modifiers&&(W=z(W,j.modifiers)),p=W,v=B,h=X(G.key2pos(j.dest),e.orientation),g=Q,b=1<n[j.dest],A=m=o,O=b&&!g,y=F?0:(O?20:10)/512*A.width,w=V(v,m),k=V(h,m),P=k[0]-w[0],E=k[1]-w[1],_=Math.atan2(E,P),S=Math.cos(_)*y,C=Math.sin(_)*y,i=$(H("line"),{stroke:p.color,"stroke-width":(M=p,T=g,I=m,(M.lineWidth||10)*(T?.85:1)/512*I.width),"stroke-linecap":"round","marker-end":F?void 0:"url(#arrowhead-"+p.key+")",opacity:Z(p,g),x1:w[0],y1:w[1],x2:k[0]-S,y2:k[1]-C})}else a=t[j.brush],s=Q,u=V(B,c=o),d=c.width/512,l=[3*d,4*d],f=(c.width+c.height)/32,i=$(H("circle"),{stroke:a.color,"stroke-width":l[s?0:1],fill:"none",opacity:Z(a,s),cx:u[0],cy:u[1],r:f-l[1]/2})}return i.setAttribute("cgHash",U),i}(r,e,t,n,a))})}(e,a,t.brushes,i,r,c)}}},{"./util":17}],16:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.files=["a","b","c","d","e","f","g","h"],t.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./types");t.colors=["white","black"],t.invRanks=[8,7,6,5,4,3,2,1],t.allKeys=(o=Array.prototype).concat.apply(o,n.files.map(function(r){return n.ranks.map(function(e){return r+e})})),t.pos2key=function(e){return t.allKeys[8*e[0]+e[1]-9]},t.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},t.memo=function(e){var r,t=function(){return void 0===r&&(r=e()),r};return t.clear=function(){r=void 0},t},t.timer=function(){var r;return{start:function(){r=Date.now()},cancel:function(){r=void 0},stop:function(){if(!r)return 0;var e=Date.now()-r;return r=void 0,e}}},t.opposite=function(e){return"white"===e?"black":"white"},t.containsX=function(e,r){return void 0!==e&&-1!==e.indexOf(r)},t.distanceSq=function(e,r){return Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2)},t.samePiece=function(e,r){return e.role===r.role&&e.color===r.color},t.computeIsTrident=function(){return-1<window.navigator.userAgent.indexOf("Trident/")};var o,i=function(e,r,t,n){return[(r?e[0]-1:8-e[0])*t,(r?8-e[1]:e[1]-1)*n]};t.posToTranslateAbs=function(e){var t=e.width/8,n=e.height/8;return function(e,r){return i(e,r,t,n)}},t.posToTranslateRel=function(e,r){return i(e,r,12.5,12.5)},t.translateAbs=function(e,r){e.style.transform="translate("+r[0]+"px,"+r[1]+"px)"},t.translateRel=function(e,r){e.style.left=r[0]+"%",e.style.top=r[1]+"%"},t.setVisible=function(e,r){e.style.visibility=r?"visible":"hidden"},t.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},t.isRightButton=function(e){return 2===e.buttons||2===e.button},t.createEl=function(e,r){var t=document.createElement(e);return r&&(t.className=r),t},t.raf=(window.requestAnimationFrame||window.setTimeout).bind(window)},{"./types":16}],18:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("./util"),c=e("./types"),u=e("./svg");function l(e,r){var t,n=s.createEl("coords",r);for(var o in e)(t=s.createEl("coord")).textContent=e[o],n.appendChild(t);return n}t.default=function(r,t,e){r.innerHTML="",r.classList.add("cg-board-wrap"),s.colors.forEach(function(e){r.classList.toggle("orientation-"+e,t.orientation===e)}),r.classList.toggle("manipulable",!t.viewOnly);var n,o,i=s.createEl("div","cg-board");if(r.appendChild(i),t.drawable.visible&&e&&((n=u.createElement("svg")).appendChild(u.createElement("defs")),r.appendChild(n)),t.coordinates){var a="black"===t.orientation?" black":"";r.appendChild(l(c.ranks,"ranks"+a)),r.appendChild(l(c.files,"files"+a))}return e&&t.draggable.showGhost&&(o=s.createEl("piece","ghost"),s.setVisible(o,!1),r.appendChild(o)),{board:i,ghost:o,svg:n}}},{"./svg":15,"./types":16,"./util":17}],19:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./stockfishqueue"),o=e("./generator"),i=e("./shapes"),a=function(){function e(e,r){this.shapes=new i.Shapes,this.stockfishQueue=new n.StockfishQueue(e,console.log),this.chessground=r}return e.prototype.perturb=function(e,r){var t=this;this.clear(),this.chessground.set({fen:e,drawable:{enabled:!1}}),new o.Generator(e).perturb(r).forEach(function(e){t.stockfishQueue.enqueue(e,function(e){t.annotate(e)})})},e.prototype.clear=function(){this.shapes.clear(),this.chessground.setShapes(this.shapes.shapes)},e.prototype.depth=function(e){this.stockfishQueue.depth=e},e.prototype.annotate=function(e){this.shapes.annotate(e),this.chessground.setShapes(this.shapes.shapes)},e}();t.AnalysisBoard=a},{"./generator":21,"./shapes":24,"./stockfishqueue":25}],20:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function r(e){this.event=e}return r.prototype.isComplete=function(){return!!r.completePattern.exec(this.event)},r.prototype.bestMove=function(){var e=r.completePattern.exec(this.event);return e?e[1]:""},r.prototype.score=function(){var e=r.matePattern.exec(this.event);return e?this.scoreMate(e[1]):(e=r.centipawnPattern.exec(this.event))?this.scoreCp(e[1]):"noScore"},r.prototype.scoreCp=function(e){return e<150&&-150<e?"drawn":0<e?"win":"lose"},r.prototype.scoreMate=function(e){return 0<e?"win":"lose"},r.matePattern=/score mate ([^ ]*) .*/,r.centipawnPattern=/score cp ([^ ]*) .*/,r.completePattern=/bestmove (....)/,r}();t.Event=n},{}],21:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=e("chess.js"),s=e("./position"),n=function(){function e(e){this.chess=new a.Chess(e)}return e.prototype.perturb=function(e){var t=this,n=this.chess.get(e);if(!n)return[];var o=new a.Chess(this.chess.fen());o.remove(e);var i=[];return this.candidateSquares(n).forEach(function(e){var r=t.validFen(n,e,o);r&&i.push(new s.Position(r,e))}),i},e.prototype.candidateSquares=function(e){return"p"==e.type?this.chess.SQUARES.filter(function(e){return/.[2-7]/.test(e)}):this.chess.SQUARES},e.prototype.validFen=function(e,r,t){if(!t.get(r)){t.put(e,r);var n=t.fen(),o=t.in_check(),i=t.in_stalemate();if(t.remove(r),!o&&!i&&this.validForOtherSide(n))return n}},e.prototype.validForOtherSide=function(e){return!new a.Chess(this.fenForOtherSide(e)).in_check()},e.prototype.fenForOtherSide=function(e){return e.includes(" w ")?e.replace(/ w .*/," b - - 0 1"):e.replace(/ b .*/," w - - 0 2")},e}();t.Generator=n},{"./position":23,"chess.js":1}],22:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./stockfishqueue");t.StockfishQueue=n.StockfishQueue;var o=e("./generator");t.Generator=o.Generator;var i=e("./position");t.Position=i.Position;var a=e("./analysisboard");t.AnalysisBoard=a.AnalysisBoard;var s=e("chessground");t.Chessground=s.Chessground},{"./analysisboard":19,"./generator":21,"./position":23,"./stockfishqueue":25,chessground:5}],23:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,r){this.fen=e,this.targetSquare=r};t.Position=n},{}],24:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.shapes=[]}return e.prototype.clear=function(){this.shapes=[]},e.prototype.annotate=function(e){this.shapes.push(this.circle(e)),this.shapes.push(this.piece(e)),"win"==e.score&&this.shapes.push(this.line(e))},e.prototype.circle=function(e){return{orig:e.targetSquare,brush:this.brush(e.score)}},e.prototype.line=function(e){var r=e.bestMove;return{orig:r.substring(0,2),dest:r.substring(2,4),brush:this.brush(e.score)}},e.prototype.piece=function(e){return{orig:e.targetSquare,brush:this.brush(e.score),piece:{color:"white",role:"king",scale:.3}}},e.prototype.brush=function(e){switch(e){case"win":return"green";case"lose":return"red";case"drawn":return"yellow";default:return"blue"}},e}();t.Shapes=n},{}],25:[function(e,r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("./event"),n=function(e,r){this.position=e,this.onComplete=r},i=function(){function e(e,r){var t=this;this.workItems=[],this.stockfish=e,this.log=r,this.depth=8,this.stockfish.postMessage("setoption name MultiPV value 1"),this.stockfish.addEventListener("message",function(e){t.sfEventHandler(e.data)})}return e.prototype.sfEventHandler=function(e){var r=new o.Event(e);if(0!=this.workItems.length){if(r.isComplete()){var t=this.workItems.shift();return t.position.bestMove=r.bestMove(),t.onComplete(t.position),void(0<this.workItems.length&&this.processNextWorkItem())}var n=r.score();"noScore"==n?this.log("ignored event: "+e):this.workItems[0].position.score=n}},e.prototype.enqueue=function(e,r){this.workItems.push(new n(e,r)),1==this.workItems.length&&this.processNextWorkItem()},e.prototype.processNextWorkItem=function(){var e=this.workItems[0].position.fen;this.stockfish.postMessage("position fen "+e),this.stockfish.postMessage("go depth "+this.depth)},e}();t.StockfishQueue=i},{"./event":20}]},{},[22])(22)});