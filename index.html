<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" href="assets/chessground.css" async>
  <link rel="stylesheet" href="assets/theme.css" async>
  <link rel="stylesheet" href="assets/examples.css">
  <meta charset="utf-8">
  <title>Perturb-o-tron</title>
  <meta name="description" content="analysis stockfish">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <script src="dist/main.js"></script>
</head>

<body>
  perturb-o-tron
  <section class="blue merida">
    <div id="chessground-examples"></div>
  </section>
  <button onclick="analyse()">go</button>
  <button onclick="lichessEditor()">Lichess editor</button> FEN:
  <input type="text" id="fen" name="fen" value="1K6/1P1k1r2/8/8/8/R7/8/8 w - - 0 1" onkeydown="onPressEnter(event,fenInputToBoard)" /> Perturb:
  <input type="text" id="perturb" name="perturb" value="b8" /> Depth:
  <input type="text" name="depth" id="depth" value="8" />
</body>

<script defer>
  /* global bundle, WebAssembly */

  var fen = document.getElementById('fen').value;
  var chessground = bundle.Chessground(document.getElementById('chessground-examples'), {
    fen: fen,
    drawable: {
      enabled: false
    }
  });

  var analysisBoard = new bundle.AnalysisBoard(loadStockfish(), chessground);

  function analyse() {
    var fen = chessground.getFen() + " w - - 0 1";
    var perturb = document.getElementById('perturb').value;
    document.getElementById('fen').value = fen;
    analysisBoard.perturb(fen, perturb);
  }

  function lichessEditor() {
    window.open("https://lichess.org/editor/" + chessground.getFen(), '_blank');
  }

  function onPressEnter(event, action) {
    (event.keyCode == 13) && action();
  }

  function fenInputToBoard() {
    chessground.set({ fen: document.getElementById('fen').value });
  }

  function loadStockfish() {
    var wasmSupported = typeof WebAssembly === 'object' && WebAssembly.validate(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
    console.log("wasmSupported:" + wasmSupported);
    return new Worker(wasmSupported ? 'vendor/stockfish.wasm.js' : 'vendor/stockfish.js');
  }
</script>

</html>
