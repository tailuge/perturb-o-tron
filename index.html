<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="stylesheet" href="assets/chessground.css" async>
  <link rel="stylesheet" href="assets/theme.css" async>
  <link rel="stylesheet" href="assets/examples.css">
  <meta charset="utf-8">
  <title>Perturb-o-tron</title>
  <meta name="description" content="analysis stockfish">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <script src="dist/main.js"></script>
</head>

<body>
  perterb-o-tron
  <section class="blue merida">
    <div id="chessground-examples"></div>
  </section>
</body>

<script defer>
  /* global bundle, WebAssembly */

  var wasmSupported = typeof WebAssembly === 'object' && WebAssembly.validate(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
  console.log("wasmSupported:" + wasmSupported);
  var stockfish = new Worker(wasmSupported ? 'vendor/stockfish.wasm.js' : 'vendor/stockfish.js');
  var stockfishQueue = new bundle.StockfishQueue(stockfish, console.log);

  var fen = '7k/8/7r/8/8/7R/8/7K w - - 0 1';
  var generator = new bundle.Generator(fen);
  var positions = generator.perturb('h3');

  var shapes = []; //positions.map(p => ({ orig: p.targetSquare, brush: 'green' }));

  var config = {
    fen: fen
  };

  var chessground = bundle.Chessground(document.getElementById('chessground-examples'), config);

  positions.forEach(p => stockfishQueue.enqueue(p, annotate));


  function annotate(position) {
    shapes.push({ orig: position.targetSquare, brush: brushScore(position.score) });
    chessground.set({
      drawable: {
        enabled: false,
        shapes: shapes
      }
    });
  }

  function brushScore(score) {
    switch (score) {
      case 'whiteWin':
        return 'green';
      case 'blackWin':
        return 'red';
      case 'draw':
        return 'yellow';
      default:
        return 'blue';
    }
  }
</script>

</html>
